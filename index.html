<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Bank - –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –ë–∞–Ω–∫</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
    <!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- PWA –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="World Bank">
    <link rel="apple-touch-icon" id="appleTouchIcon" href="#">
    <link rel="manifest" id="webAppManifest" href="#">
    <meta name="theme-color" content="#0d1b2a">
    <meta name="mobile-web-app-capable" content="yes">
    
    <style>
        :root {
            /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ - —Å—Ç—Ä–æ–≥–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ü–≤–µ—Ç–∞ */
            --primary: #0d1b2a;
            --secondary: #1b263b;
            --accent: #415a77;
            --success: #2e7d32;
            --danger: #c62828;
            --warning: #f9a825;
            --light: #e0e1dd;
            --dark: #0a0f1c;
            --card-bg: rgba(27, 38, 59, 0.8);
            --gradient-bank: linear-gradient(135deg, #0d1b2a, #1b263b, #415a77);
            --gradient-chf: linear-gradient(135deg, #1b4332, #2d6a4f, #40916c);
            --gradient-eur: linear-gradient(135deg, #023e8a, #0077b6, #0096c7);
            --gradient-krw: linear-gradient(135deg, #6a040f, #9d0208, #d00000);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-heavy: 0 8px 15px rgba(0, 0, 0, 0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            min-height: 100%;
            overflow-x: hidden;
            background: linear-gradient(135deg, var(--dark), #0d1b2a);
            background-attachment: fixed;
            background-size: cover;
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 20px; 
            background: transparent;
            color: var(--light); 
            margin: 0 auto;
            max-width: 500px;
            position: relative;
            min-height: 100vh;
            /* –£–±–∏—Ä–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –∏–∑ body */
            overflow-y: auto;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(13, 27, 42, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(65, 90, 119, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, var(--dark), #0d1b2a);
            z-index: -2;
            background-attachment: fixed;
        }
        
        h1, h2, h3, h4 { 
            font-family: 'Montserrat', sans-serif;
            margin: 10px 0; 
            color: var(--light);
            font-weight: 600;
        }
        
        .card { 
            border-radius: 12px; 
            padding: 25px; 
            margin-bottom: 25px; 
            color: white; 
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            animation: fadeInUp 0.5s ease-out;
            background-attachment: scroll !important;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .CHF { 
            background: var(--gradient-chf) !important;
            border-left: 4px solid #2d6a4f;
        }
        
        .EUR { 
            background: var(--gradient-eur) !important;
            border-left: 4px solid #0077b6;
        }
        
        .KRW { 
            background: var(--gradient-krw) !important;
            border-left: 4px solid #9d0208;
        }
        
        .BANK { 
            background: var(--gradient-bank) !important;
            border-left: 4px solid var(--accent);
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        button, input, select { 
            width: 100%; 
            padding: 16px 20px; 
            margin-top: 12px; 
            border: none; 
            border-radius: 8px; 
            background: rgba(255, 255, 255, 0.05); 
            color: white; 
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è select —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        select {
            background-color: rgba(13, 27, 42, 0.7) !important;
            color: white !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 15px center !important;
            background-size: 20px !important;
            padding-right: 45px !important;
            cursor: pointer;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–ø—Ü–∏–π –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ */
        select option {
            background-color: #0d1b2a !important;
            color: white !important;
            padding: 12px !important;
            font-size: 16px;
            border: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ */
        select option:checked,
        select option:selected {
            background-color: var(--accent) !important;
            color: white !important;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (placeholder) */
        select:invalid {
            color: rgba(255, 255, 255, 0.5) !important;
        }
        
        /* –î–ª—è Firefox */
        @-moz-document url-prefix() {
            select {
                color: white !important;
                text-shadow: 0 0 0 white;
            }
            
            select option {
                background-color: #0d1b2a;
                color: white;
            }
            
            select:focus option:checked {
                background: var(--accent) !important;
                color: white !important;
            }
        }
        
        button { 
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        button:hover::after {
            left: 100%;
        }
        
        button:hover { 
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(65, 90, 119, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .hidden { 
            display: none; 
        }
        
        .admin { 
            background: rgba(13, 27, 42, 0.95); 
            padding: 25px; 
            border-radius: 12px; 
            color: white; 
            margin-top: 20px; 
            border: 1px solid rgba(65, 90, 119, 0.5);
        }
        
        .status { 
            padding: 18px; 
            border-radius: 8px; 
            margin: 20px 0; 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success { 
            background: rgba(46, 125, 50, 0.9); 
            border-left: 4px solid #2d6a4f;
        }
        
        .error { 
            background: rgba(198, 40, 40, 0.9); 
            border-left: 4px solid #9d0208;
        }
        
        .balance-display {
            font-size: 36px;
            font-weight: 700;
            margin: 20px 0;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            color: #fff;
        }
        
        .currency-name {
            font-size: 14px;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        label {
            display: block;
            margin-top: 25px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ì–†–ê–§–ò–ö–ê */
        .chart-container-wrapper {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-title {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* –ß–ï–¢–ö–ò–ô –ò –ü–†–û–ü–û–†–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ì–†–ê–§–ò–ö */
        .chart-container {
            width: 100%;
            height: 180px;
            position: relative;
            margin: 5px 0;
        }
        
        .chart-inner {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .rates-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .rate-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .rate-box:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .rate-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--accent);
            margin-top: 8px;
        }
        
        .rate-label {
            font-size: 11px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .section-title {
            font-size: 18px;
            margin: 30px 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(65, 90, 119, 0.5);
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .transfer-section {
            margin: 30px 0;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }
        
        .pin-section {
            margin: 25px 0;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .balance-card {
            margin: 20px 0;
            padding: 25px;
            position: relative;
            overflow: visible;
        }
        
        .spacer {
            height: 20px;
        }
        
        .spacer-large {
            height: 30px;
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(65, 90, 119, 0.5), transparent);
            margin: 30px 0;
        }
        
        .divider-thick {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            margin: 35px 0;
        }
        
        .funds-control {
            margin: 25px 0;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #1b4332, #2d6a4f) !important;
        }
        
        .add-btn:hover {
            background: linear-gradient(135deg, #2d6a4f, #1b4332) !important;
        }
        
        .remove-btn {
            background: linear-gradient(135deg, #6a040f, #9d0208) !important;
        }
        
        .remove-btn:hover {
            background: linear-gradient(135deg, #9d0208, #6a040f) !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–ª–∞–≥–æ–≤ –∏ –∏–∫–æ–Ω–æ–∫ */
        .flag-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            position: relative;
        }
        
        .country-flag {
            font-size: 60px;
            text-align: center;
            margin: 10px 0;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        .country-name {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin: 10px 0;
            color: #fff;
        }
        
        .welcome-message {
            text-align: center;
            font-size: 14px;
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        /* –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ - —Å—Ç—Ä–æ–≥–∏–π –¥–∏–∑–∞–π–Ω */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--gradient-bank);
            border-radius: 12px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-size: 40px;
            color: #fff;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            position: relative;
            z-index: 1;
        }
        
        .bank-title {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .bank-title h1 {
            font-size: 22px;
            color: #fff;
            margin-bottom: 5px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .bank-title p {
            font-size: 12px;
            opacity: 0.8;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 0.5px;
        }
        
        /* –ò–∫–æ–Ω–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö */
        .section-title i {
            color: var(--accent);
            font-size: 20px;
        }
        
        /* –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ */
        .decoration {
            position: fixed;
            pointer-events: none;
            z-index: -1;
        }
        
        .decoration-1 {
            top: 10%;
            left: 5%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(65, 90, 119, 0.1) 0%, transparent 70%);
        }
        
        .decoration-2 {
            bottom: 10%;
            right: 5%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(13, 27, 42, 0.1) 0%, transparent 70%);
        }
        
        /* –°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø */
        .secret-access {
            margin-top: 20px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(65, 90, 119, 0.2), rgba(13, 27, 42, 0.2));
            border: 1px solid rgba(65, 90, 119, 0.3);
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            color: #fff;
            display: none;
        }
        
        /* –ò–∫–æ–Ω–∫–∏ –≤ –∫–Ω–æ–ø–∫–∞—Ö */
        button i {
            margin-right: 8px;
            font-size: 16px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 600px) {
            html, body {
                background: linear-gradient(135deg, var(--dark), #0d1b2a) !important;
                background-attachment: fixed !important;
            }
            
            body {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .balance-display {
                font-size: 32px;
            }
            
            .country-flag {
                font-size: 50px;
            }
            
            .logo-container {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .logo {
                font-size: 35px;
            }
            
            .bank-title h1 {
                font-size: 20px;
            }
            
            select {
                padding-right: 40px !important;
                background-position: right 12px center !important;
            }
            
            .chart-container-wrapper {
                padding: 12px;
                margin: 20px 0;
            }
            
            .chart-container {
                height: 160px;
                margin: 3px 0;
            }
            
            body::before {
                background: 
                    radial-gradient(circle at 20% 80%, rgba(13, 27, 42, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(65, 90, 119, 0.2) 0%, transparent 50%),
                    linear-gradient(135deg, var(--dark), #0d1b2a);
                background-attachment: fixed;
            }
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            display: none;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        .info-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-text i {
            color: var(--accent);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        
        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π */
        .required:after {
            content: " *";
            color: var(--danger);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        button:disabled:hover {
            transform: none;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        .bank-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(65, 90, 119, 0.5);
        }
        
        .banker-welcome {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ô –°–¢–ò–õ–¨ –î–õ–Ø –ß–ï–ö–ë–û–ö–°–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø */
        .confirm-checkbox {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .confirm-checkbox:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .confirm-checkbox input[type="checkbox"] {
            display: none;
        }
        
        .confirm-checkbox label {
            margin: 0;
            cursor: pointer;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            text-transform: none;
            letter-spacing: normal;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            padding-left: 45px;
            line-height: 1.5;
        }
        
        .confirm-checkbox label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 26px;
            height: 26px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .confirm-checkbox label::after {
            content: '‚úì';
            position: absolute;
            left: 9px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            transition: transform 0.3s ease;
        }
        
        .confirm-checkbox input[type="checkbox"]:checked + label::before {
            background: linear-gradient(135deg, #2d6a4f, #40916c);
            border-color: #2d6a4f;
        }
        
        .confirm-checkbox input[type="checkbox"]:checked + label::after {
            transform: translateY(-50%) scale(1);
        }
        
        .confirm-checkbox input[type="checkbox"]:focus + label::before {
            box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.3);
        }
        
        /* –ü–õ–ê–í–ù–´–ô –°–ö–†–û–õ–õ –î–õ–Ø –ö–û–ù–¢–ï–ô–ù–ï–†–û–í */
        .scrollable-container {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) rgba(255, 255, 255, 0.05);
            padding-right: 5px;
        }
        
        .scrollable-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollable-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .scrollable-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
        
        .scrollable-container::-webkit-scrollbar-thumb:hover {
            background: #4a6fa1;
        }
        
        /* –¢–†–ê–ù–ó–ê–ö–¶–ò–ò –° –ü–õ–ê–í–ù–´–ú –°–ö–†–û–õ–õ–û–ú */
        .transactions-container {
            max-height: 250px;
            overflow-y: auto;
            margin: 15px 0;
            padding-right: 10px;
        }
        
        .transaction-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }
        
        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .transaction-amount {
            font-weight: bold;
            font-size: 16px;
            color: var(--accent);
        }
        
        .transaction-details {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }
        
        .transaction-date {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 3px;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–∞—Ä–æ–ª–µ–π –≤ –ø–∞–Ω–µ–ª–∏ –±–∞–Ω–∫–∏—Ä–∞ */
        .password-display {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 13px;
            color: #ffcc00;
        }
        
        .show-password-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .show-password-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ë–ê–õ–ê–ù–°–û–í –ë–ê–ù–ö–ò–†–ê –° –ü–õ–ê–í–ù–´–ú –°–ö–†–û–õ–õ–û–ú */
        .balances-scroll-container {
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
            padding-right: 10px;
        }
        
        .balance-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .balance-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }
        
        .balance-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .balance-flag {
            font-size: 24px;
        }
        
        .balance-details {
            display: flex;
            flex-direction: column;
        }
        
        .balance-country {
            font-weight: bold;
            font-size: 14px;
        }
        
        .balance-value {
            font-size: 16px;
            font-weight: 700;
        }
        
        /* –í–ê–õ–Æ–¢–ù–´–ô –ö–û–ù–í–ï–†–¢–ï–† –í –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ú –†–ê–°–ß–ï–¢–ï */
        .conversion-details {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }
        
        .conversion-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 13px;
        }
        
        .conversion-rate {
            color: var(--warning);
            font-weight: bold;
        }
        
        /* –°–¢–†–û–ì–ò–ô –°–¢–ò–õ–¨ –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –û –ü–ï–†–ï–í–û–î–ï */
        .transfer-notification {
            background: rgba(27, 38, 59, 0.95);
            border: 1px solid rgba(65, 90, 119, 0.5);
            border-left: 4px solid #2d6a4f;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .transfer-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #2d6a4f, #40916c, #2d6a4f);
        }
        
        .notification-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(65, 90, 119, 0.3);
        }
        
        .notification-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #2d6a4f, #40916c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }
        
        .notification-title {
            flex: 1;
        }
        
        .notification-title h4 {
            font-size: 18px;
            margin: 0 0 5px 0;
            color: #fff;
        }
        
        .notification-title p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }
        
        .notification-details {
            margin: 20px 0;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }
        
        .conversion-note {
            background: rgba(249, 168, 37, 0.1);
            border: 1px solid rgba(249, 168, 37, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .notification-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(65, 90, 119, 0.3);
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* –ù–û–í–´–ô –†–ê–ó–î–ï–õ: –ù–ê–°–¢–†–û–ô–ö–ê –ò–ö–û–ù–û–ö */
        .icon-customization {
            margin: 30px 0;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .icon-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .icon-preview-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .icon-preview-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }
        
        .icon-preview-icon {
            font-size: 30px;
            color: var(--accent);
        }
        
        .icon-preview-name {
            font-size: 12px;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ò–ö–û–ù–û–ö –° –ü–†–û–ö–†–£–¢–ö–û–ô */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .icon-selector::-webkit-scrollbar {
            width: 0;
            height: 0;
            display: none;
        }
        
        .icon-option {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 20px;
        }
        
        .icon-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }
        
        .icon-option.selected {
            background: var(--accent);
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(65, 90, 119, 0.5);
        }
        
        .icon-option-img {
            width: 30px;
            height: 30px;
            object-fit: contain;
            border-radius: 4px;
        }
        
        .icon-section-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        /* –ó–ê–ì–†–£–ó–ö–ê PNG/JPG –ò–ö–û–ù–û–ö */
        .upload-icon-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-preview {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .upload-preview::-webkit-scrollbar {
            width: 0;
            height: 0;
            display: none;
        }
        
        .uploaded-icon {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .uploaded-icon:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        
        .uploaded-icon.selected {
            border-color: var(--success);
            box-shadow: 0 0 10px rgba(46, 125, 50, 0.5);
        }
        
        .uploaded-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .uploaded-icon-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 9px;
            padding: 2px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .delete-icon-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
        }
        
        .upload-info {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 8px;
            text-align: center;
        }
        
        /* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ö–û–ù–ê–ú–ò */
        .icon-management-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ò–ï –ó–ê–ì–û–õ–û–í–ö–ê "–í–•–û–î –í –°–ò–°–¢–ï–ú–£" */
        .login-title {
            text-align: center;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        /* ==================== –ü–û–õ–ù–û–ï –°–ö–†–´–¢–ò–ï –ü–û–õ–û–° –ü–†–û–ö–†–£–¢–ö–ò ==================== */
        html, body {
            overflow: auto !important;
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }

        body * {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }

        ::-webkit-scrollbar {
            width: 0 !important;
            height: 0 !important;
            background: transparent !important;
            display: none !important;
        }

        ::-webkit-scrollbar-track {
            background: transparent !important;
            display: none !important;
        }

        ::-webkit-scrollbar-thumb {
            background: transparent !important;
            display: none !important;
            border: none !important;
        }

        ::-webkit-scrollbar-corner {
            background: transparent !important;
            display: none !important;
        }

        .scrollable-container,
        .transactions-container,
        .balances-scroll-container,
        .icon-selector,
        .upload-preview,
        .upload-icon-section {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }

        .scrollable-container::-webkit-scrollbar,
        .transactions-container::-webkit-scrollbar,
        .balances-scroll-container::-webkit-scrollbar,
        .icon-selector::-webkit-scrollbar,
        .upload-preview::-webkit-scrollbar,
        .upload-icon-section::-webkit-scrollbar {
            width: 0 !important;
            height: 0 !important;
            display: none !important;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            -webkit-overflow-scrolling: touch;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è PWA-–∏–∫–æ–Ω–∫–∏ */
        .pwa-icon-preview {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .pwa-icon-display {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pwa-icon-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .pwa-icon-display i {
            font-size: 50px;
            color: var(--accent);
            opacity: 0.7;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .sync-status {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .sync-connected {
            background: rgba(45, 106, 79, 0.8);
            color: white;
        }
        
        .sync-disconnected {
            background: rgba(157, 2, 8, 0.8);
            color: white;
        }
        
        .sync-offline {
            background: rgba(249, 168, 37, 0.8);
            color: white;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <div id="syncStatus" class="sync-status sync-offline hidden">
        <div class="sync-indicator"></div>
        <span id="syncText">–û—Ñ–ª–∞–π–Ω</span>
    </div>
    
    <!-- –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ–Ω–∞ -->
    <div class="decoration decoration-1"></div>
    <div class="decoration decoration-2"></div>
    
    <!-- –õ–æ–≥–æ—Ç–∏–ø –±–∞–Ω–∫–∞ -->
    <div class="logo-container">
        <div class="logo" id="appLogo">
            <i class="fas fa-university"></i>
        </div>
        <div class="bank-title">
            <h1>WORLD BANK INTERNATIONAL</h1>
            <p>–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞</p>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –≤—Ö–æ–¥–∞ -->
    <div id="login">
        <div class="card BANK">
            <h3 class="login-title">
                <i class="fas fa-lock"></i> –í–•–û–î –í –°–ò–°–¢–ï–ú–£
            </h3>
            
            <label for="role" class="required"><i class="fas fa-globe"></i> –í–´–ë–ï–†–ò–¢–ï –°–¢–†–ê–ù–£:</label>
            <select id="role">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É --</option>
                <option value="CHF">üá®üá≠ –®–≤–µ–π—Ü–∞—Ä–∏—è</option>
                <option value="EUR">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                <option value="KRW">üá∞üá∑ –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
            </select>
            <div class="info-text">
                <i class="fas fa-info-circle"></i> –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –≤—Ö–æ–¥–∞
            </div>
            
            <div class="spacer"></div>
            
            <label for="pin" class="required"><i class="fas fa-key"></i> –í–í–ï–î–ò–¢–ï –ü–ê–†–û–õ–¨:</label>
            <input id="pin" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (4+ —Å–∏–º–≤–æ–ª–æ–≤)" minlength="4">
            <div class="info-text">
                <i class="fas fa-info-circle"></i> –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤
            </div>
            
            <button onclick="login()" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> –í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£
            </button>
            
            <div class="loader" id="loginLoader"></div>
            
            <div id="loginMessage" class="status hidden notification"></div>
            
            <!-- –°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø -->
            <div class="secret-access" id="secretAccess">
                <i class="fas fa-user-secret"></i> –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
            </div>
            
            <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ë–ê–ù–ö–ï -->
            <div class="info-text" style="margin-top: 25px; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <i class="fas fa-shield-alt"></i> –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∏–≥—Ä–æ–∫–∞ -->
    <div id="account" class="hidden">
        <!-- –ë–∞–ª–∞–Ω—Å —Å —Ñ–ª–∞–≥–æ–º -->
        <div id="card" class="card balance-card">
            <div class="flag-container">
                <div id="countryFlag" class="country-flag"></div>
            </div>
            
            <div id="countryName" class="country-name"></div>
            
            <div class="welcome-message" id="welcomeMessage">
                <i class="fas fa-handshake"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –±–∞–Ω–∫
            </div>
            
            <div class="balance-display" id="balanceAmount">0.00</div>
            <div class="currency-name" id="currencyCode">
                <i class="fas fa-coins"></i> –ë–ê–õ–ê–ù–° –°–ß–ï–¢–ê
            </div>
        </div>
        
        <!-- –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö –ö–£–†–°–ê –í–ê–õ–Æ–¢ - –ß–ï–¢–ö–ò–ô –ò –ü–†–û–ü–û–†–¶–ò–û–ù–ê–õ–¨–ù–´–ô -->
        <div class="chart-container-wrapper">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="fas fa-chart-line"></i> –ì–†–ê–§–ò–ö –ö–£–†–°–ê –í–ê–õ–Æ–¢–´
                </div>
                <div class="chart-time" id="chartTime">–û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–µ–π—á–∞—Å</div>
            </div>
            
            <div class="info-text" style="margin-bottom: 10px;">
                <i class="fas fa-info-circle"></i> –î–∏–Ω–∞–º–∏–∫–∞ –∫—É—Ä—Å–∞ –≤–∞—à–µ–π –≤–∞–ª—é—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥
            </div>
            
            <div class="chart-container">
                <div class="chart-inner">
                    <canvas id="exchangeChart"></canvas>
                </div>
            </div>
            
            <!-- –£–ü–†–û–©–ï–ù–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ö–£–†–°–û–í –í–ê–õ–Æ–¢ -->
            <div class="rates-grid" style="margin-top: 20px;">
                <div class="rate-box">
                    <div class="rate-label">
                        <i class="fas fa-flag"></i> üá®üá≠ –®–≤–µ–π—Ü–∞—Ä–∏—è
                    </div>
                    <div class="rate-value" id="chfRate">1.00 CHF</div>
                    <div class="rate-label">–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</div>
                </div>
                <div class="rate-box">
                    <div class="rate-label">
                        <i class="fas fa-flag"></i> üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è
                    </div>
                    <div class="rate-value" id="eurRate">0.93 EUR</div>
                    <div class="rate-label">1 EUR = 0.93 CHF</div>
                </div>
                <div class="rate-box">
                    <div class="rate-label">
                        <i class="fas fa-flag"></i> üá∞üá∑ –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è
                    </div>
                    <div class="rate-value" id="krwRate">0.00077 KRW</div>
                    <div class="rate-label">1 KRW = 0.00077 CHF</div>
                </div>
            </div>
        </div>
        
        <!-- –ü–†–û–ú–ï–ñ–£–¢–û–ö –ú–ï–ñ–î–£ –ì–†–ê–§–ò–ö–û–ú –ò –ü–ï–†–ï–í–û–î–û–ú -->
        <div class="spacer-large"></div>
        <div class="divider-thick"></div>
        <div class="spacer-large"></div>
        
        <!-- –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É –±–∞–Ω–∫–∞–º–∏ -->
        <div class="transfer-section">
            <h3 class="section-title">
                <i class="fas fa-exchange-alt"></i> –ü–ï–†–ï–í–û–î –ú–ï–ñ–î–£ –ë–ê–ù–ö–ê–ú–ò
            </h3>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ü–µ—Ä–µ–≤–æ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∞–º–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞–ª–æ–≥–æ–≤. –ü–µ—Ä–µ–≤–æ–¥—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
            </div>
            
            <label for="to" class="required"><i class="fas fa-user-check"></i> –ü–û–õ–£–ß–ê–¢–ï–õ–¨:</label>
            <select id="to">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–Ω–∫ --</option>
                <option value="CHF">üá®üá≠ –®–≤–µ–π—Ü–∞—Ä–∏—è</option>
                <option value="EUR">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                <option value="KRW">üá∞üá∑ –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
            </select>
            
            <div class="spacer"></div>
            
            <label for="amount" class="required"><i class="fas fa-money-bill-wave"></i> –°–£–ú–ú–ê –ü–ï–†–ï–í–û–î–ê:</label>
            <input id="amount" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="1" step="0.01">
            <div class="info-text">
                <i class="fas fa-info-circle"></i> –î–æ—Å—Ç—É–ø–Ω–æ: <span id="availableBalance">0</span> <span id="currentCurrency">CHF</span>
            </div>
            
            <div id="transferPreview" class="status hidden notification" style="margin-top: 20px;">
                <h4><i class="fas fa-calculator"></i> –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:</h4>
                <p><i class="fas fa-percentage"></i> –ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞ (<span id="feeBank">2</span>%): <span id="commission">0.00</span></p>
                <p><i class="fas fa-receipt"></i> –ù–∞–ª–æ–≥ (<span id="feeTax">3</span>%): <span id="tax">0.00</span></p>
                <p><i class="fas fa-hand-holding-usd"></i> –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç: <span id="net">0.00</span></p>
                
                <!-- –ë–ª–æ–∫ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤–∞–ª—é—Ç—ã -->
                <div id="currencyConversion" class="conversion-details hidden">
                    <h5 style="margin-bottom: 10px; color: var(--warning);">
                        <i class="fas fa-exchange-alt"></i> –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã:
                    </h5>
                    <div class="conversion-row">
                        <span>–°—É–º–º–∞ –≤ –≤–∞–ª—é—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:</span>
                        <span id="fromAmount">0.00</span>
                    </div>
                    <div class="conversion-row">
                        <span>–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:</span>
                        <span class="conversion-rate" id="conversionRate">1.00</span>
                    </div>
                    <div class="conversion-row">
                        <span>–°—É–º–º–∞ –≤ –≤–∞–ª—é—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</span>
                        <span id="toAmount">0.00</span>
                    </div>
                </div>
            </div>
            
            <!-- –£–õ–£–ß–®–ï–ù–ù–´–ô –ß–ï–ö–ë–û–ö–° –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø -->
            <div class="confirm-checkbox" id="confirmCheckbox" style="display: none;">
                <input type="checkbox" id="confirmTransfer">
                <label for="confirmTransfer">
                    ‚úÖ –Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –ø–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –∏ —Å–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞. 
                    –í—Å–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞–ª–æ–≥–∏ —É—á—Ç–µ–Ω—ã –≤ —Ä–∞—Å—á–µ—Ç–µ.
                </label>
            </div>
            
            <div class="spacer"></div>
            
            <button onclick="transfer()" id="transferBtn" disabled>
                <i class="fas fa-paper-plane"></i> –í–´–ü–û–õ–ù–ò–¢–¨ –ü–ï–†–ï–í–û–î
            </button>
        </div>
        
        <!-- –£–õ–£–ß–®–ï–ù–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ü–ï–†–ï–í–û–î–ï -->
        <div id="transferNotification" class="transfer-notification hidden">
            <div class="notification-header">
                <div class="notification-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="notification-title">
                    <h4>–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ</h4>
                    <p>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π</p>
                </div>
            </div>
            
            <div class="notification-details">
                <div class="detail-row">
                    <div class="detail-label">
                        <i class="fas fa-exchange-alt"></i>
                        <span>–û–ø–µ—Ä–∞—Ü–∏—è:</span>
                    </div>
                    <div class="detail-value" id="notifOperation">–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label">
                        <i class="fas fa-arrow-up"></i>
                        <span>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</span>
                    </div>
                    <div class="detail-value" id="notifSent">0.00</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label">
                        <i class="fas fa-arrow-down"></i>
                        <span>–ü–æ–ª—É—á–µ–Ω–æ:</span>
                    </div>
                    <div class="detail-value" id="notifReceived">0.00</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label">
                        <i class="fas fa-percentage"></i>
                        <span>–ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞:</span>
                    </div>
                    <div class="detail-value" id="notifCommission">0.00</div>
                </div>
                
                <div class="detail-row">
                    <div class="detail-label">
                        <i class="fas fa-receipt"></i>
                        <span>–ù–∞–ª–æ–≥:</span>
                    </div>
                    <div class="detail-value" id="notifTax">0.00</div>
                </div>
                
                <div class="detail-row" id="notifConversionRow" style="display: none;">
                    <div class="detail-label">
                        <i class="fas fa-exchange-alt"></i>
                        <span>–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:</span>
                    </div>
                    <div class="detail-value" id="notifRate">1.00</div>
                </div>
            </div>
            
            <div id="notifConversionNote" class="conversion-note" style="display: none;">
                <i class="fas fa-info-circle"></i> –°—É–º–º–∞ –±—ã–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä—ã–Ω–æ—á–Ω–æ–º—É –∫—É—Ä—Å—É
            </div>
            
            <div class="notification-footer">
                <i class="fas fa-shield-alt"></i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            </div>
        </div>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –° –ü–õ–ê–í–ù–´–ú –°–ö–†–û–õ–õ–û–ú -->
        <div class="transfer-section">
            <h3 class="section-title">
                <i class="fas fa-history"></i> –ò–°–¢–û–†–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô
            </h3>
            <div id="transactionHistory" class="transactions-container">
                <p style="text-align: center; opacity: 0.7; font-size: 14px; padding: 20px;">
                    –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
                </p>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–º -->
        <div class="pin-section">
            <h3 class="section-title">
                <i class="fas fa-key"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ê–†–û–õ–ï–ú
            </h3>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
            </div>
            
            <label for="newPin" class="required"><i class="fas fa-lock"></i> –ù–û–í–´–ô –ü–ê–†–û–õ–¨:</label>
            <input id="newPin" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (4+ —Å–∏–º–≤–æ–ª–æ–≤)" minlength="4">
            
            <div class="spacer"></div>
            
            <button onclick="changePin()" id="changePinBtn">
                <i class="fas fa-save"></i> –ò–ó–ú–ï–ù–ò–¢–¨ –ü–ê–†–û–õ–¨
            </button>
        </div>
        
        <div class="action-buttons">
            <button onclick="showHelp()">
                <i class="fas fa-question-circle"></i> –ü–û–ú–û–©–¨
            </button>
            <button onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> –í–´–ô–¢–ò
            </button>
        </div>
        
        <!-- –°—Ç–∞—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ) -->
        <div id="transferDetails" class="status hidden notification" style="margin-top: 25px; display: none;"></div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ï–≤—Ä–æ—Å–æ—é–∑–∞ -->
    <div id="banker" class="hidden admin">
        <div class="bank-header">
            <div class="logo" style="font-size: 35px;">
                <i class="fas fa-crown"></i>
            </div>
            <div>
                <h3>–ù–ê–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ë–ê–ù–ö –ï–í–†–û–°–û–Æ–ó–ê</h3>
                <div class="banker-welcome">
                    <i class="fas fa-star"></i> –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </div>
            </div>
        </div>
        
        <!-- –ë–∞–ª–∞–Ω—Å—ã —Å –ø–∞—Ä–æ–ª—è–º–∏ –° –ü–õ–ê–í–ù–´–ú –°–ö–†–û–õ–õ–û–ú -->
        <div class="card BANK">
            <h4><i class="fas fa-wallet"></i> –¢–ï–ö–£–©–ò–ï –ë–ê–õ–ê–ù–°–´ –ò –ü–ê–†–û–õ–ò:</h4>
            <div id="bBalances" class="balances-scroll-container">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ -->
        <div class="funds-control">
            <h4><i class="fas fa-money-check-alt"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–†–ï–î–°–¢–í–ê–ú–ò</h4>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–ª–∏ —Å–ø–∏—Å—ã–≤–∞–π—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–æ–≤ —Å—Ç—Ä–∞–Ω
            </div>
            
            <label for="fundCountry" class="required"><i class="fas fa-flag"></i> –í–´–ë–ï–†–ò–¢–ï –°–¢–†–ê–ù–£:</label>
            <select id="fundCountry">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É --</option>
                <option value="CHF">üá®üá≠ –®–≤–µ–π—Ü–∞—Ä–∏—è</option>
                <option value="EUR">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                <option value="KRW">üá∞üá∑ –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
            </select>
            
            <div class="spacer"></div>
            
            <label for="fundAmount" class="required"><i class="fas fa-coins"></i> –°–£–ú–ú–ê:</label>
            <input id="fundAmount" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="1" step="0.01">
            
            <div class="control-buttons">
                <button onclick="addFunds()" class="add-btn" id="addFundsBtn">
                    <i class="fas fa-plus-circle"></i> –î–û–ë–ê–í–ò–¢–¨ –°–†–ï–î–°–¢–í–ê
                </button>
                <button onclick="removeFunds()" class="remove-btn" id="removeFundsBtn">
                    <i class="fas fa-minus-circle"></i> –°–ü–ò–°–ê–¢–¨ –°–†–ï–î–°–¢–í–ê
                </button>
            </div>
        </div>
        
        <!-- –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö –î–õ–Ø –ë–ê–ù–ö–ò–†–ê - –ß–ï–¢–ö–ò–ô –ò –ü–†–û–ü–û–†–¶–ò–û–ù–ê–õ–¨–ù–´–ô -->
        <div class="chart-container-wrapper">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="fas fa-chart-bar"></i> –ì–†–ê–§–ò–ö –ö–£–†–°–û–í –í–ê–õ–Æ–¢
                </div>
                <div class="chart-time">–î–∏–Ω–∞–º–∏–∫–∞ –≤—Å–µ—Ö –≤–∞–ª—é—Ç</div>
            </div>
            
            <div class="info-text" style="margin-bottom: 10px;">
                <i class="fas fa-info-circle"></i> –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∫—É—Ä—Å–æ–≤ –≤—Å–µ—Ö –≤–∞–ª—é—Ç –±–∞–Ω–∫–∞
            </div>
            
            <div class="chart-container">
                <div class="chart-inner">
                    <canvas id="bankerChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- –ü–†–û–ú–ï–ñ–£–¢–û–ö –î–õ–Ø –ë–ê–ù–ö–ò–†–ê -->
        <div class="spacer-large"></div>
        <div class="divider-thick"></div>
        <div class="spacer-large"></div>
        
        <!-- –ù–û–í–´–ô –ò–ù–°–¢–†–£–ú–ï–ù–¢: –ù–ê–°–¢–†–û–ô–ö–ê PWA-–ò–ö–û–ù–ö–ò -->
        <div class="icon-customization">
            <h4><i class="fas fa-mobile-alt"></i> –ù–ê–°–¢–†–û–ô–ö–ê PWA-–ò–ö–û–ù–ö–ò</h4>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∫–æ–Ω–∫—É –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ iPhone/Android
            </div>
            
            <div class="file-input-container">
                <input type="file" id="pwaIconUpload" accept=".png,.jpg,.jpeg" onchange="handlePWAIconUpload(event)">
                <label for="pwaIconUpload" class="file-input-label">
                    <i class="fas fa-cloud-upload-alt"></i> –ó–ê–ì–†–£–ó–ò–¢–¨ PWA-–ò–ö–û–ù–ö–£ (PNG/JPEG)
                </label>
            </div>
            
            <div class="upload-info">
                <i class="fas fa-info-circle"></i> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 512x512 –ø–∏–∫—Å–µ–ª–µ–π
            </div>
            
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π PWA-–∏–∫–æ–Ω–∫–∏ -->
            <div class="pwa-icon-preview">
                <div class="pwa-icon-display" id="pwaIconDisplay">
                    <i class="fas fa-university"></i>
                </div>
            </div>
            
            <div class="spacer"></div>
            
            <button onclick="applyPwaIcon()" id="applyPwaBtn" disabled>
                <i class="fas fa-check-circle"></i> –ü–†–ò–ú–ï–ù–ò–¢–¨ –ö–ê–ö –ò–ö–û–ù–ö–£ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
            </button>
            
            <div class="info-text" style="margin-top: 15px;">
                <i class="fas fa-exclamation-circle"></i> –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
            </div>
        </div>
        
        <!-- –ù–û–í–´–ô –†–ê–ó–î–ï–õ: –ù–ê–°–¢–†–û–ô–ö–ê –ò–ö–û–ù–û–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø -->
        <div class="icon-customization">
            <h4><i class="fas fa-palette"></i> –ù–ê–°–¢–†–û–ô–ö–ê –ò–ö–û–ù–û–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø</h4>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            </div>
            
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –∏–∫–æ–Ω–æ–∫ -->
            <div class="icon-preview">
                <div class="icon-preview-item">
                    <div class="icon-preview-icon" id="previewLogo">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="icon-preview-name">–õ–æ–≥–æ—Ç–∏–ø –±–∞–Ω–∫–∞</div>
                </div>
                <div class="icon-preview-item">
                    <div class="icon-preview-icon" id="previewLock">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="icon-preview-name">–ò–∫–æ–Ω–∫–∞ –≤—Ö–æ–¥–∞</div>
                </div>
                <div class="icon-preview-item">
                    <div class="icon-preview-icon" id="previewTransfer">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="icon-preview-name">–ò–∫–æ–Ω–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞</div>
                </div>
                <div class="icon-preview-item">
                    <div class="icon-preview-icon" id="previewHistory">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="icon-preview-name">–ò–∫–æ–Ω–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏</div>
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ PNG/JPG –∏–∫–æ–Ω–æ–∫ -->
            <div class="upload-icon-section">
                <h5><i class="fas fa-upload"></i> –ó–ê–ì–†–£–ó–ö–ê PNG/JPG –ò–ö–û–ù–û–ö</h5>
                
                <div class="info-text" style="margin-bottom: 15px;">
                    <i class="fas fa-info-circle"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –∏–∫–æ–Ω–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö PNG –∏–ª–∏ JPG
                </div>
                
                <div class="file-input-container">
                    <input type="file" id="iconUpload" accept=".png,.jpg,.jpeg,.gif,.svg" multiple>
                    <label for="iconUpload" class="file-input-label">
                        <i class="fas fa-cloud-upload-alt"></i> –ü–ï–†–ï–¢–ê–©–ò–¢–ï –§–ê–ô–õ–´ –ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –í–´–ë–û–†–ê
                    </label>
                </div>
                
                <div class="upload-info">
                    <i class="fas fa-info-circle"></i> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã: PNG, JPG, JPEG, GIF, SVG (–º–∞–∫—Å. 500KB)
                </div>
                
                <div class="spacer"></div>
                
                <!-- –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ -->
                <h5><i class="fas fa-images"></i> –ó–ê–ì–†–£–ñ–ï–ù–ù–´–ï –ò–ö–û–ù–ö–ò:</h5>
                <div id="uploadedIconsPreview" class="upload-preview">
                    <p style="text-align: center; opacity: 0.7; font-size: 14px; width: 100%; padding: 20px;">
                        –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
                    </p>
                </div>
                
                <div class="icon-management-buttons">
                    <button onclick="useUploadedIcon()" id="useUploadedBtn" disabled>
                        <i class="fas fa-check"></i> –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –í–´–ë–†–ê–ù–ù–£–Æ
                    </button>
                    <button onclick="clearUploadedIcons()" class="remove-btn">
                        <i class="fas fa-trash"></i> –û–ß–ò–°–¢–ò–¢–¨ –í–°–ï
                    </button>
                </div>
            </div>
            
            <div class="icon-section-row">
                <div>
                    <label for="iconCategory"><i class="fas fa-filter"></i> –ö–ê–¢–ï–ì–û–†–ò–Ø –ò–ö–û–ù–û–ö:</label>
                    <select id="iconCategory" onchange="loadIcons()">
                        <option value="all">–í—Å–µ –∏–∫–æ–Ω–∫–∏</option>
                        <option value="banking">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ</option>
                        <option value="finance">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ</option>
                        <option value="security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
                        <option value="interface">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</option>
                        <option value="uploaded">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ</option>
                    </select>
                </div>
                
                <div>
                    <label for="iconTarget"><i class="fas fa-crosshairs"></i> –¶–ï–õ–ï–í–û–ô –≠–õ–ï–ú–ï–ù–¢:</label>
                    <select id="iconTarget">
                        <option value="logo">–õ–æ–≥–æ—Ç–∏–ø –±–∞–Ω–∫–∞</option>
                        <option value="lock">–ò–∫–æ–Ω–∫–∞ –≤—Ö–æ–¥–∞</option>
                        <option value="transfer">–ò–∫–æ–Ω–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞</option>
                        <option value="history">–ò–∫–æ–Ω–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏</option>
                        <option value="flag_chf">–§–ª–∞–≥ –®–≤–µ–π—Ü–∞—Ä–∏–∏</option>
                        <option value="flag_eur">–§–ª–∞–≥ –ì–µ—Ä–º–∞–Ω–∏–∏</option>
                        <option value="flag_krw">–§–ª–∞–≥ –ö–æ—Ä–µ–∏</option>
                    </select>
                </div>
            </div>
            
            <div class="spacer"></div>
            
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∫–æ–Ω–æ–∫ - –° –ü–†–û–ö–†–£–¢–ö–û–ô -->
            <div id="iconSelectorContainer" class="icon-selector">
                <!-- –ò–∫–æ–Ω–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="spacer"></div>
            
            <button onclick="applyIcon()" id="applyIconBtn">
                <i class="fas fa-check-circle"></i> –ü–†–ò–ú–ï–ù–ò–¢–¨ –í–´–ë–†–ê–ù–ù–£–Æ –ò–ö–û–ù–ö–£
            </button>
            
            <div class="spacer"></div>
            
            <button onclick="resetIcons()" class="remove-btn">
                <i class="fas fa-undo"></i> –°–ë–†–û–°–ò–¢–¨ –ò–ö–û–ù–ö–ò –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ
            </button>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã -->
        <div style="margin: 30px 0; padding: 25px; background: var(--card-bg); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h4><i class="fas fa-cogs"></i> –ù–ê–°–¢–†–û–ô–ö–ê –°–ò–°–¢–ï–ú–´</h4>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞–ª–æ–≥–∏ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
            </div>
            
            <label for="bankFee"><i class="fas fa-percentage"></i> –ö–û–ú–ò–°–°–ò–Ø –ë–ê–ù–ö–ê (%):</label>
            <input id="bankFee" type="number" step="0.1" min="0" max="50" placeholder="–ö–æ–º–∏—Å—Å–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö">
            
            <div class="spacer"></div>
            
            <label for="taxFee"><i class="fas fa-receipt"></i> –ù–ê–õ–û–ì (%):</label>
            <input id="taxFee" type="number" step="0.1" min="0" max="50" placeholder="–ù–∞–ª–æ–≥ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö">
            
            <div class="spacer"></div>
            
            <button onclick="saveFees()" id="saveFeesBtn">
                <i class="fas fa-save"></i> –°–û–•–†–ê–ù–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò
            </button>
        </div>
        
        <div class="divider"></div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ -->
        <div style="margin: 30px 0; padding: 25px; background: var(--card-bg); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h4><i class="fas fa-ban"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–õ–û–ö–ò–†–û–í–ö–ê–ú–ò</h4>
            
            <div class="info-text" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> –ë–ª–æ–∫–∏—Ä—É–π—Ç–µ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞
            </div>
            
            <label for="blockSelect" class="required"><i class="fas fa-flag"></i> –í–´–ë–ï–†–ò–¢–ï –°–¢–†–ê–ù–£:</label>
            <select id="blockSelect">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É --</option>
                <option value="CHF">üá®üá≠ –®–≤–µ–π—Ü–∞—Ä–∏—è</option>
                <option value="EUR">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                <option value="KRW">üá∞üá∑ –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
            </select>
            
            <div class="spacer"></div>
            
            <button onclick="toggleBlock()" id="toggleBlockBtn">
                <i class="fas fa-lock"></i> –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ / <i class="fas fa-unlock"></i> –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨
            </button>
            
            <div id="blockStatus" class="status notification" style="margin-top: 25px;"></div>
        </div>
        
        <!-- –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –° –ü–õ–ê–í–ù–´–ú –°–ö–†–û–õ–õ–û–ú -->
        <div style="margin: 30px 0; padding: 25px; background: var(--card-bg); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h4><i class="fas fa-list-alt"></i> –í–°–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò</h4>
            <div id="allTransactions" class="transactions-container">
                <p style="text-align: center; opacity: 0.7; font-size: 14px; padding: 20px;">
                    –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
                </p>
            </div>
        </div>
        
        <div class="action-buttons">
            <button onclick="resetGame()" class="remove-btn">
                <i class="fas fa-redo"></i> –û–ë–ù–£–õ–ò–¢–¨ –°–ß–ï–¢–ê
            </button>
            <button onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> –í–´–ô–¢–ò
            </button>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDLTca8RAf7iH__n59banrhvSKL6b1GgRg",
            authDomain: "national-banks.firebaseapp.com",
            projectId: "national-banks",
            storageBucket: "national-banks.firebasestorage.app",
            messagingSenderId: "778858264268",
            appId: "1:778858264268:web:7af66dfb1f38ac8dd77469",
            measurementId: "G-W1CBM8S8VH"
        };
        
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let pins = {};
        let balances = {};
        let fees = {};
        let exchangeRates = {};
        let blockedAccounts = [];
        let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
        let exchangeChart = null;
        let bankerChart = null;
        let rateHistory = { CHF: [], EUR: [], KRW: [] };
        let secretMode = false;
        let bankerKeySequence = [];
        const bankerSecretCode = ['b', 'a', 'n', 'k', 'e', 'r'];
        let transactions = [];
        let showPasswords = false;
        let customIcons = JSON.parse(localStorage.getItem("bankCustomIcons")) || {};
        let uploadedIcons = JSON.parse(localStorage.getItem("bankUploadedIcons")) || [];
        let selectedIcon = "fas fa-university";
        let selectedUploadedIcon = null;
        let pwaIconData = localStorage.getItem("bankPwaIcon") || "";
        
        // Firebase –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let firebaseApp = null;
        let firebaseDatabase = null;
        let databaseRef = null;
        let syncEnabled = true;
        let lastSyncTime = null;
        let isOnline = navigator.onLine;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ====================
        window.onload = async function() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            await initializeFirebase();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            initializeData();
            setupEventListeners();
            loadCustomIcons();
            initPWA();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω
            if (currentUser) {
                if (currentUser === "BANK") {
                    secretMode = true;
                }
                
                document.getElementById("login").classList.add("hidden");
                
                if (currentUser === "BANK") {
                    document.getElementById("banker").classList.remove("hidden");
                    updateBanker();
                    updateBlockStatus();
                    updateBankerFees();
                    updateAllTransactions();
                    initBankerChart();
                    loadIcons();
                    updateUploadedIconsPreview();
                } else {
                    document.getElementById("account").classList.remove("hidden");
                    updateAccount();
                    updateTransactionHistory();
                    initExchangeChart();
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–ª–∞–≤–∏—à
            document.addEventListener('keydown', function(event) {
                bankerKeySequence.push(event.key.toLowerCase());
                
                if (bankerKeySequence.length > bankerSecretCode.length) {
                    bankerKeySequence.shift();
                }
                
                if (arraysEqual(bankerKeySequence, bankerSecretCode)) {
                    activateSecretMode();
                    bankerKeySequence = [];
                }
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
            if (syncEnabled) {
                startSync();
            }
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE ====================
        async function initializeFirebase() {
    try {
        console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ Firebase
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        firebaseApp = firebase.initializeApp(firebaseConfig);
        firebaseDatabase = firebase.database();
        databaseRef = firebaseDatabase.ref('worldBank');
        
        console.log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        updateSyncStatus('connected');
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        setupFirebaseListeners();
        
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
        updateSyncStatus('disconnected');
        syncEnabled = false;
        showMessage("‚ö†Ô∏è Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ.", "error");
    }
}
    

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –°–õ–£–®–ê–¢–ï–õ–ï–ô FIREBASE ====================
        function setupFirebaseListeners() {
            if (!databaseRef) return;
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–ª–∞–Ω—Å–∞—Ö
            databaseRef.child('balances').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remoteBalances = snapshot.val();
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
                    if (JSON.stringify(balances) !== JSON.stringify(remoteBalances)) {
                        balances = { ...remoteBalances };
                        saveLocalData();
                        
                        if (currentUser && currentUser !== "BANK") {
                            updateAccount();
                        }
                        if (currentUser === "BANK") {
                            updateBanker();
                        }
                    }
                }
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–∞—Ä–æ–ª—è—Ö
            databaseRef.child('pins').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remotePins = snapshot.val();
                    if (JSON.stringify(pins) !== JSON.stringify(remotePins)) {
                        pins = remotePins;
                        saveLocalData();
                    }
                }
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
            databaseRef.child('transactions').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remoteTransactions = snapshot.val();
                    if (JSON.stringify(transactions) !== JSON.stringify(remoteTransactions)) {
                        transactions = remoteTransactions || [];
                        saveLocalData();
                        
                        if (currentUser && currentUser !== "BANK") {
                            updateTransactionHistory();
                        }
                        if (currentUser === "BANK") {
                            updateAllTransactions();
                        }
                    }
                }
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç
            databaseRef.child('exchangeRates').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remoteRates = snapshot.val();
                    if (JSON.stringify(exchangeRates) !== JSON.stringify(remoteRates)) {
                        exchangeRates = { ...remoteRates };
                        saveLocalData();
                        
                        if (currentUser && currentUser !== "BANK") {
                            updateAccount();
                            if (exchangeChart) exchangeChart.update();
                        }
                    }
                }
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–∞—Ö
            databaseRef.child('blockedAccounts').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remoteBlocks = snapshot.val() || [];
                    if (JSON.stringify(blockedAccounts) !== JSON.stringify(remoteBlocks)) {
                        blockedAccounts = remoteBlocks;
                        saveLocalData();
                        
                        if (currentUser === "BANK") {
                            updateBlockStatus();
                        }
                    }
                }
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–∏—Å—Å–∏—è—Ö
            databaseRef.child('fees').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const remoteFees = snapshot.val();
                    if (JSON.stringify(fees) !== JSON.stringify(remoteFees)) {
                        fees = remoteFees;
                        saveLocalData();
                        
                        if (currentUser === "BANK") {
                            updateBankerFees();
                        }
                    }
                }
            });
        }

        // ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
        async function startSync() {
            if (!syncEnabled || !databaseRef) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
                const snapshot = await databaseRef.once('value');
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞
                    if (data.balances) balances = { ...data.balances };
                    if (data.pins) pins = data.pins;
                    if (data.transactions) transactions = data.transactions;
                    if (data.exchangeRates) exchangeRates = { ...data.exchangeRates };
                    if (data.blockedAccounts) blockedAccounts = data.blockedAccounts;
                    if (data.fees) fees = data.fees;
                    if (data.rateHistory) rateHistory = data.rateHistory;
                    
                    saveLocalData();
                    
                    console.log("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞");
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    if (currentUser && currentUser !== "BANK") {
                        updateAccount();
                        updateTransactionHistory();
                    }
                    if (currentUser === "BANK") {
                        updateBanker();
                        updateAllTransactions();
                        updateBankerFees();
                        updateBlockStatus();
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await syncAllDataToFirebase();
                }
                
                updateSyncStatus('connected');
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:", error);
                updateSyncStatus('disconnected');
            }
        }

        // ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –í–°–ï–• –î–ê–ù–ù–´–• –í FIREBASE ====================
        async function syncAllDataToFirebase() {
            if (!syncEnabled || !databaseRef) return;
            
            try {
                const dataToSync = {
                    balances,
                    pins,
                    transactions,
                    exchangeRates,
                    blockedAccounts,
                    fees,
                    rateHistory,
                    lastUpdated: Date.now()
                };
                
                await databaseRef.set(dataToSync);
                lastSyncTime = Date.now();
                
                console.log("–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å Firebase");
                updateSyncStatus('connected');
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Firebase:", error);
                updateSyncStatus('disconnected');
            }
        }

        // ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –û–¢–î–ï–õ–¨–ù–´–• –î–ê–ù–ù–´–• ====================
        async function syncDataToFirebase(dataType, data) {
            if (!syncEnabled || !databaseRef) return;
            
            try {
                await databaseRef.child(dataType).set(data);
                lastSyncTime = Date.now();
                
                console.log(`${dataType} —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å Firebase`);
                updateSyncStatus('connected');
                
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ${dataType}:`, error);
                updateSyncStatus('disconnected');
            }
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò ====================
        function updateSyncStatus(status) {
            const syncStatus = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            
            syncStatus.classList.remove('hidden');
            
            switch(status) {
                case 'connected':
                    syncStatus.className = 'sync-status sync-connected';
                    syncText.textContent = '–û–Ω–ª–∞–π–Ω';
                    break;
                case 'disconnected':
                    syncStatus.className = 'sync-status sync-disconnected';
                    syncText.textContent = '–û—à–∏–±–∫–∞';
                    break;
                case 'offline':
                    syncStatus.className = 'sync-status sync-offline';
                    syncText.textContent = '–û—Ñ–ª–∞–π–Ω';
                    break;
            }
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–ù–õ–ê–ô–ù –°–¢–ê–¢–£–°–ê ====================
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                updateSyncStatus('connected');
                if (syncEnabled) {
                    startSync();
                }
            } else {
                updateSyncStatus('offline');
            }
        }

        // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –õ–û–ö–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–• ====================
        function saveLocalData() {
            try {
                localStorage.setItem("bankPins", JSON.stringify(pins));
                localStorage.setItem("bankBalances", JSON.stringify(balances));
                localStorage.setItem("bankFees", JSON.stringify(fees));
                localStorage.setItem("exchangeRates", JSON.stringify(exchangeRates));
                localStorage.setItem("bankBlocks", JSON.stringify(blockedAccounts));
                localStorage.setItem("rateHistory", JSON.stringify(rateHistory));
                localStorage.setItem("bankTransactions", JSON.stringify(transactions));
                localStorage.setItem("bankCustomIcons", JSON.stringify(customIcons));
                localStorage.setItem("bankUploadedIcons", JSON.stringify(uploadedIcons));
                if (pwaIconData) {
                    localStorage.setItem("bankPwaIcon", pwaIconData);
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:", error);
            }
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø saveAll ====================
        function saveAll() {
            saveLocalData();
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Firebase –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
            if (syncEnabled && databaseRef) {
                syncAllDataToFirebase();
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
        function initializeData() {
            try {
                pins = JSON.parse(localStorage.getItem("bankPins")) || {};
                balances = JSON.parse(localStorage.getItem("bankBalances")) || {};
                fees = JSON.parse(localStorage.getItem("bankFees")) || {};
                exchangeRates = JSON.parse(localStorage.getItem("exchangeRates")) || {};
                blockedAccounts = JSON.parse(localStorage.getItem("bankBlocks")) || [];
                rateHistory = JSON.parse(localStorage.getItem("rateHistory")) || { CHF: [], EUR: [], KRW: [] };
                transactions = JSON.parse(localStorage.getItem("bankTransactions")) || [];
                customIcons = JSON.parse(localStorage.getItem("bankCustomIcons")) || {};
                uploadedIcons = JSON.parse(localStorage.getItem("bankUploadedIcons")) || [];
                pwaIconData = localStorage.getItem("bankPwaIcon") || "";

                // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å 0 –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω
                if (Object.keys(balances).length === 0) {
                    balances = { CHF: 0, EUR: 0, KRW: 0 };
                }
                
                if (Object.keys(exchangeRates).length === 0) {
                    exchangeRates = { 
                        CHF: 1.00,
                        EUR: 0.93,
                        KRW: 0.00077
                    };
                }
                
                if (Object.keys(fees).length === 0) {
                    fees = { bank: 2, tax: 3 };
                }

                if (rateHistory.CHF.length === 0) {
                    for (let i = 0; i < 12; i++) {
                        const baseCHF = 1.00;
                        const baseEUR = 0.93;
                        const baseKRW = 0.00077;
                        
                        const chfVariation = baseCHF + (Math.sin(i * 0.5) * 0.01) + ((Math.random() - 0.5) * 0.005);
                        const eurVariation = baseEUR + (Math.sin(i * 0.5 + 1) * 0.015) + ((Math.random() - 0.5) * 0.008);
                        const krwVariation = baseKRW + (Math.sin(i * 0.5 + 2) * 0.00002) + ((Math.random() - 0.5) * 0.00001);
                        
                        rateHistory.CHF.push(chfVariation);
                        rateHistory.EUR.push(eurVariation);
                        rateHistory.KRW.push(krwVariation * 1000);
                    }
                }

                saveAll();
                console.log("–î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã");

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
                pins = {};
                balances = { CHF: 0, EUR: 0, KRW: 0 };
                fees = { bank: 2, tax: 3 };
                exchangeRates = { CHF: 1.00, EUR: 0.93, KRW: 0.00077 };
                blockedAccounts = [];
                customIcons = {};
                uploadedIcons = [];
                pwaIconData = "";
                
                rateHistory = {
                    CHF: [],
                    EUR: [],
                    KRW: []
                };
                
                for (let i = 0; i < 12; i++) {
                    const baseCHF = 1.00;
                    const baseEUR = 0.93;
                    const baseKRW = 0.00077;
                    
                    const chfVariation = baseCHF + (Math.sin(i * 0.5) * 0.01) + ((Math.random() - 0.5) * 0.005);
                    const eurVariation = baseEUR + (Math.sin(i * 0.5 + 1) * 0.015) + ((Math.random() - 0.5) * 0.008);
                    const krwVariation = baseKRW + (Math.sin(i * 0.5 + 2) * 0.00002) + ((Math.random() - 0.5) * 0.00001);
                    
                    rateHistory.CHF.push(chfVariation);
                    rateHistory.EUR.push(eurVariation);
                    rateHistory.KRW.push(krwVariation * 1000);
                }
                
                transactions = [];
                saveAll();
            }
        }

        // ==================== PWA-–ò–ö–û–ù–ö–ê ====================
        function initPWA() {
            updatePwaIconPreview();
            
            if (pwaIconData) {
                updateAppleTouchIcon();
                updateWebAppManifest();
            }
        }

        function updatePwaIconPreview() {
            const display = document.getElementById('pwaIconDisplay');
            if (pwaIconData) {
                display.innerHTML = `<img src="${pwaIconData}" alt="PWA –ò–∫–æ–Ω–∫–∞">`;
            } else {
                display.innerHTML = `<i class="fas fa-university"></i>`;
            }
        }

        function handlePWAIconUpload(event) {
            const file = event.target.files[0];
            const maxSize = 1024 * 1024;
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showMessage("‚ùå –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º", "error");
                return;
            }
            
            if (file.size > maxSize) {
                showMessage("‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 1MB)", "error");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                pwaIconData = e.target.result;
                document.getElementById('applyPwaBtn').disabled = false;
                
                const img = new Image();
                img.onload = function() {
                    updatePwaIconPreview();
                    showMessage("‚úÖ –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ '–ü—Ä–∏–º–µ–Ω–∏—Ç—å'", "success");
                };
                img.src = pwaIconData;
            };
            reader.readAsDataURL(file);
        }

        function applyPwaIcon() {
            if (!pwaIconData) {
                showMessage("‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∫–æ–Ω–∫—É", "error");
                return;
            }
            
            try {
                localStorage.setItem("bankPwaIcon", pwaIconData);
                updateAppleTouchIcon();
                updateWebAppManifest();
                
                showMessage("‚úÖ PWA-–∏–∫–æ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞! –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ", "success");
                document.getElementById('applyPwaBtn').disabled = true;
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ PWA-–∏–∫–æ–Ω–∫–∏:", error);
                showMessage("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∫–æ–Ω–∫–∏", "error");
            }
        }

        function updateAppleTouchIcon() {
            let link = document.getElementById('appleTouchIcon');
            if (link) {
                link.href = pwaIconData;
            }
        }

        function updateWebAppManifest() {
            const manifest = {
                "name": "World Bank International",
                "short_name": "World Bank",
                "description": "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#0d1b2a",
                "theme_color": "#0d1b2a",
                "orientation": "portrait"
            };
            
            if (pwaIconData) {
                manifest.icons = [
                    {
                        "src": pwaIconData,
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "any maskable"
                    }
                ];
            }
            
            const manifestBlob = new Blob([JSON.stringify(manifest, null, 2)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            
            let manifestLink = document.getElementById('webAppManifest');
            if (manifestLink) {
                manifestLink.href = manifestURL;
            }
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –ö–ê–°–¢–û–ú–ù–´–• –ò–ö–û–ù–û–ö ====================
        function loadCustomIcons() {
            if (customIcons.logo) {
                if (customIcons.logo.startsWith('data:')) {
                    document.getElementById('appLogo').innerHTML = `<img src="${customIcons.logo}" class="icon-option-img" style="width: 40px; height: 40px;">`;
                    document.getElementById('previewLogo').innerHTML = `<img src="${customIcons.logo}" class="icon-option-img">`;
                } else {
                    document.getElementById('appLogo').innerHTML = `<i class="${customIcons.logo}"></i>`;
                    document.getElementById('previewLogo').innerHTML = `<i class="${customIcons.logo}"></i>`;
                }
            }
            
            if (customIcons.lock) {
                if (customIcons.lock.startsWith('data:')) {
                    document.querySelector('.card.BANK h3 i').outerHTML = `<img src="${customIcons.lock}" style="width: 20px; height: 20px; vertical-align: middle;">`;
                    document.getElementById('previewLock').innerHTML = `<img src="${customIcons.lock}" class="icon-option-img">`;
                } else {
                    document.querySelector('.card.BANK h3 i').className = customIcons.lock;
                    document.getElementById('previewLock').innerHTML = `<i class="${customIcons.lock}"></i>`;
                }
            }
            
            if (customIcons.transfer) {
                if (customIcons.transfer.startsWith('data:')) {
                    document.querySelector('.transfer-section .section-title i').outerHTML = `<img src="${customIcons.transfer}" style="width: 20px; height: 20px; vertical-align: middle;">`;
                    document.getElementById('previewTransfer').innerHTML = `<img src="${customIcons.transfer}" class="icon-option-img">`;
                } else {
                    document.querySelector('.transfer-section .section-title i').className = customIcons.transfer;
                    document.getElementById('previewTransfer').innerHTML = `<i class="${customIcons.transfer}"></i>`;
                }
            }
            
            if (customIcons.history) {
                if (customIcons.history.startsWith('data:')) {
                    document.querySelector('.transfer-section:nth-of-type(3) .section-title i').outerHTML = `<img src="${customIcons.history}" style="width: 20px; height: 20px; vertical-align: middle;">`;
                    document.getElementById('previewHistory').innerHTML = `<img src="${customIcons.history}" class="icon-option-img">`;
                } else {
                    document.querySelector('.transfer-section:nth-of-type(3) .section-title i').className = customIcons.history;
                    document.getElementById('previewHistory').innerHTML = `<i class="${customIcons.history}"></i>`;
                }
            }
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ====================
        function setupEventListeners() {
            document.getElementById("pin").addEventListener("keypress", function(event) {
                if (event.key === "Enter") login();
            });

            document.getElementById("amount").addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    if (!document.getElementById("login").classList.contains("hidden")) {
                        login();
                    } else {
                        transfer();
                    }
                }
            });

            document.getElementById("amount").addEventListener("input", updateTransferPreview);
            document.getElementById("to").addEventListener("change", updateTransferPreview);
            
            document.getElementById("confirmTransfer")?.addEventListener("change", function() {
                const transferBtn = document.getElementById("transferBtn");
                transferBtn.disabled = !this.checked;
            });
            
            document.getElementById("newPin").addEventListener("input", function() {
                const btn = document.getElementById("changePinBtn");
                btn.disabled = this.value.length < 4;
            });
            
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('icon-option') || 
                    event.target.parentElement.classList.contains('icon-option')) {
                    const iconOption = event.target.classList.contains('icon-option') ? 
                        event.target : event.target.parentElement;
                    
                    const iconOptions = document.querySelectorAll('.icon-option');
                    iconOptions.forEach(opt => opt.classList.remove('selected'));
                    iconOption.classList.add('selected');
                    
                    if (iconOption.querySelector('i')) {
                        selectedIcon = iconOption.querySelector('i').className;
                    } else if (iconOption.querySelector('img')) {
                        selectedIcon = iconOption.querySelector('img').src;
                    }
                    
                    const uploadedIcons = document.querySelectorAll('.uploaded-icon');
                    uploadedIcons.forEach(icon => icon.classList.remove('selected'));
                    selectedUploadedIcon = null;
                    document.getElementById('useUploadedBtn').disabled = true;
                }
            });
            
            document.getElementById('iconUpload').addEventListener('change', handleIconUpload);
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê PNG/JPG –ò–ö–û–ù–û–ö ====================
        function handleIconUpload(event) {
            const files = event.target.files;
            const maxSize = 500 * 1024;
            
            for (let file of files) {
                if (file.size > maxSize) {
                    showMessage(`‚ùå –§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 500KB)`, "error");
                    continue;
                }
                
                if (!file.type.match('image.*')) {
                    showMessage(`‚ùå –§–∞–π–ª "${file.name}" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º`, "error");
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const iconData = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result,
                        type: file.type,
                        size: file.size,
                        date: new Date().toISOString()
                    };
                    
                    uploadedIcons.push(iconData);
                    saveLocalData();
                    updateUploadedIconsPreview();
                    
                    showMessage(`‚úÖ –ò–∫–æ–Ω–∫–∞ "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞`, "success");
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }

        function updateUploadedIconsPreview() {
            const container = document.getElementById('uploadedIconsPreview');
            
            if (uploadedIcons.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; opacity: 0.7; font-size: 14px; width: 100%; padding: 20px;">
                        –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç
                    </p>
                `;
                return;
            }
            
            let html = '';
            uploadedIcons.forEach((icon, index) => {
                html += `
                    <div class="uploaded-icon" data-index="${index}" onclick="selectUploadedIcon(${index})">
                        <button class="delete-icon-btn" onclick="deleteUploadedIcon(${index}, event)">√ó</button>
                        <img src="${icon.data}" alt="${icon.name}">
                        <div class="uploaded-icon-name">${icon.name.length > 10 ? icon.name.substring(0, 10) + '...' : icon.name}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function selectUploadedIcon(index) {
            const uploadedIconsElements = document.querySelectorAll('.uploaded-icon');
            uploadedIconsElements.forEach(icon => icon.classList.remove('selected'));
            
            uploadedIconsElements[index].classList.add('selected');
            selectedUploadedIcon = uploadedIcons[index];
            
            const iconOptions = document.querySelectorAll('.icon-option');
            iconOptions.forEach(opt => opt.classList.remove('selected'));
            selectedIcon = null;
            
            document.getElementById('useUploadedBtn').disabled = false;
        }

        function useUploadedIcon() {
            if (!selectedUploadedIcon) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É", "error");
                return;
            }
            
            const target = document.getElementById('iconTarget').value;
            customIcons[target] = selectedUploadedIcon.data;
            
            applyIconFromData(selectedUploadedIcon.data, target);
            
            localStorage.setItem("bankCustomIcons", JSON.stringify(customIcons));
            
            showMessage(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ "${target}"`, "success");
        }

        function deleteUploadedIcon(index, event) {
            event.stopPropagation();
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∏–∫–æ–Ω–∫—É "${uploadedIcons[index].name}"?`)) {
                uploadedIcons.splice(index, 1);
                saveLocalData();
                updateUploadedIconsPreview();
                
                if (selectedUploadedIcon && selectedUploadedIcon.id === uploadedIcons[index]?.id) {
                    selectedUploadedIcon = null;
                    document.getElementById('useUploadedBtn').disabled = true;
                }
                
                showMessage("‚úÖ –ò–∫–æ–Ω–∫–∞ —É–¥–∞–ª–µ–Ω–∞", "success");
            }
        }

        function clearUploadedIcons() {
            if (uploadedIcons.length === 0) {
                showMessage("‚ùå –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", "error");
                return;
            }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ (${uploadedIcons.length} —à—Ç.)?`)) {
                uploadedIcons = [];
                saveLocalData();
                updateUploadedIconsPreview();
                selectedUploadedIcon = null;
                document.getElementById('useUploadedBtn').disabled = true;
                
                showMessage("‚úÖ –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —É–¥–∞–ª–µ–Ω—ã", "success");
            }
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –ò–ö–û–ù–û–ö –î–õ–Ø –í–´–ë–û–†–ê ====================
        function loadIcons() {
            const category = document.getElementById('iconCategory').value;
            const container = document.getElementById('iconSelectorContainer');
            
            if (category === 'uploaded') {
                loadUploadedIconsToSelector();
                return;
            }
            
            const iconLibrary = {
                all: [
                    'fas fa-university', 'fas fa-landmark', 'fas fa-building',
                    'fas fa-lock', 'fas fa-lock-open', 'fas fa-key',
                    'fas fa-money-bill-wave', 'fas fa-coins', 'fas fa-piggy-bank',
                    'fas fa-exchange-alt', 'fas fa-credit-card', 'fas fa-wallet',
                    'fas fa-shield-alt', 'fas fa-user-shield', 'fas fa-fingerprint',
                    'fas fa-history', 'fas fa-chart-line', 'fas fa-chart-bar',
                    'fas fa-calculator', 'fas fa-percentage', 'fas fa-receipt',
                    'fas fa-globe', 'fas fa-flag', 'fas fa-crown',
                    'fas fa-star', 'fas fa-gem', 'fas fa-diamond',
                    'fas fa-briefcase', 'fas fa-suitcase', 'fas fa-plane'
                ],
                banking: [
                    'fas fa-university', 'fas fa-landmark', 'fas fa-building',
                    'fas fa-money-bill-wave', 'fas fa-coins', 'fas fa-piggy-bank',
                    'fas fa-credit-card', 'fas fa-wallet', 'fas fa-cash-register',
                    'fas fa-hand-holding-usd', 'fas fa-money-check-alt', 'fas fa-file-invoice-dollar'
                ],
                finance: [
                    'fas fa-chart-line', 'fas fa-chart-bar', 'fas fa-chart-pie',
                    'fas fa-calculator', 'fas fa-percentage', 'fas fa-receipt',
                    'fas fa-exchange-alt', 'fas fa-balance-scale', 'fas fa-business-time',
                    'fas fa-search-dollar', 'fas fa-file-invoice', 'fas fa-sack-dollar'
                ],
                security: [
                    'fas fa-lock', 'fas fa-lock-open', 'fas fa-key',
                    'fas fa-shield-alt', 'fas fa-user-shield', 'fas fa-fingerprint',
                    'fas fa-id-card', 'fas fa-passport', 'fas fa-mask',
                    'fas fa-eye', 'fas fa-eye-slash', 'fas fa-qrcode'
                ],
                interface: [
                    'fas fa-star', 'fas fa-gem', 'fas fa-diamond',
                    'fas fa-crown', 'fas fa-trophy', 'fas fa-medal',
                    'fas fa-globe', 'fas fa-flag', 'fas fa-map-marker-alt',
                    'fas fa-bell', 'fas fa-envelope', 'fas fa-comment-dollar'
                ]
            };
            
            const icons = iconLibrary[category] || iconLibrary.all;
            
            let html = '';
            icons.forEach(icon => {
                html += `
                    <div class="icon-option" data-icon="${icon}">
                        <i class="${icon}"></i>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            const firstIcon = container.querySelector('.icon-option');
            if (firstIcon) {
                firstIcon.classList.add('selected');
                selectedIcon = firstIcon.getAttribute('data-icon');
            }
        }

        function loadUploadedIconsToSelector() {
            const container = document.getElementById('iconSelectorContainer');
            
            if (uploadedIcons.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: rgba(255,255,255,0.5);">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ –Ω–µ—Ç</p>
                        <p style="font-size: 12px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ PNG/JPG –∏–∫–æ–Ω–∫–∏ –≤—ã—à–µ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            uploadedIcons.forEach((icon, index) => {
                html += `
                    <div class="icon-option" data-icon="${icon.data}" onclick="selectUploadedIconForUse(${index})">
                        <img src="${icon.data}" class="icon-option-img" alt="${icon.name}">
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            const firstIcon = container.querySelector('.icon-option');
            if (firstIcon) {
                firstIcon.classList.add('selected');
                selectedIcon = firstIcon.getAttribute('data-icon');
            }
        }

        function selectUploadedIconForUse(index) {
            const iconOptions = document.querySelectorAll('.icon-option');
            iconOptions.forEach(opt => opt.classList.remove('selected'));
            
            iconOptions[index].classList.add('selected');
            selectedIcon = uploadedIcons[index].data;
            
            const uploadedIconsElements = document.querySelectorAll('.uploaded-icon');
            uploadedIconsElements.forEach(icon => icon.classList.remove('selected'));
            selectedUploadedIcon = null;
            document.getElementById('useUploadedBtn').disabled = true;
        }

        // ==================== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –í–´–ë–†–ê–ù–ù–û–ô –ò–ö–û–ù–ö–ò ====================
        function applyIcon() {
            const target = document.getElementById('iconTarget').value;
            const btn = document.getElementById('applyIconBtn');
            
            if (!selectedIcon && !selectedUploadedIcon) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞", "error");
                return;
            }
            
            btn.disabled = true;
            
            const iconToSave = selectedIcon || selectedUploadedIcon?.data;
            customIcons[target] = iconToSave;
            
            applyIconFromData(iconToSave, target);
            
            localStorage.setItem("bankCustomIcons", JSON.stringify(customIcons));
            
            showMessage(`‚úÖ –ò–∫–æ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!`, "success");
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        function applyIconFromData(iconData, target) {
            if (iconData.startsWith('data:')) {
                const imgElementSmall = `<img src="${iconData}" style="width: 20px; height: 20px; vertical-align: middle;">`;
                
                switch(target) {
                    case 'logo':
                        document.getElementById('appLogo').innerHTML = `<img src="${iconData}" style="width: 40px; height: 40px; object-fit: contain;">`;
                        document.getElementById('previewLogo').innerHTML = `<img src="${iconData}" class="icon-option-img">`;
                        break;
                    case 'lock':
                        document.querySelector('.card.BANK h3 i').outerHTML = imgElementSmall;
                        document.getElementById('previewLock').innerHTML = `<img src="${iconData}" class="icon-option-img">`;
                        break;
                    case 'transfer':
                        document.querySelector('.transfer-section .section-title i').outerHTML = imgElementSmall;
                        document.getElementById('previewTransfer').innerHTML = `<img src="${iconData}" class="icon-option-img">`;
                        break;
                    case 'history':
                        document.querySelector('.transfer-section:nth-of-type(3) .section-title i').outerHTML = imgElementSmall;
                        document.getElementById('previewHistory').innerHTML = `<img src="${iconData}" class="icon-option-img">`;
                        break;
                }
            } else {
                switch(target) {
                    case 'logo':
                        document.getElementById('appLogo').innerHTML = `<i class="${iconData}"></i>`;
                        document.getElementById('previewLogo').innerHTML = `<i class="${iconData}"></i>`;
                        break;
                    case 'lock':
                        document.querySelector('.card.BANK h3 i').className = iconData;
                        document.getElementById('previewLock').innerHTML = `<i class="${iconData}"></i>`;
                        break;
                    case 'transfer':
                        document.querySelector('.transfer-section .section-title i').className = iconData;
                        document.getElementById('previewTransfer').innerHTML = `<i class="${iconData}"></i>`;
                        break;
                    case 'history':
                        document.querySelector('.transfer-section:nth-of-type(3) .section-title i').className = iconData;
                        document.getElementById('previewHistory').innerHTML = `<i class="${iconData}"></i>`;
                        break;
                }
            }
        }

        function resetIcons() {
            if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∏–∫–æ–Ω–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?")) {
                return;
            }
            
            customIcons = {};
            localStorage.removeItem("bankCustomIcons");
            
            document.getElementById('appLogo').innerHTML = `<i class="fas fa-university"></i>`;
            document.querySelector('.card.BANK h3 i').className = 'fas fa-lock';
            document.querySelector('.transfer-section .section-title i').className = 'fas fa-exchange-alt';
            document.querySelector('.transfer-section:nth-of-type(3) .section-title i').className = 'fas fa-history';
            
            document.getElementById('previewLogo').innerHTML = `<i class="fas fa-university"></i>`;
            document.getElementById('previewLock').innerHTML = `<i class="fas fa-lock"></i>`;
            document.getElementById('previewTransfer').innerHTML = `<i class="fas fa-exchange-alt"></i>`;
            document.getElementById('previewHistory').innerHTML = `<i class="fas fa-history"></i>`;
            
            showMessage("‚úÖ –ò–∫–æ–Ω–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é", "success");
        }

        // ==================== –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢ –° –ö–û–ù–í–ï–†–¢–ê–¶–ò–ï–ô –í–ê–õ–Æ–¢ ====================
        function updateTransferPreview() {
            const amountInput = document.getElementById("amount");
            const to = document.getElementById("to").value;
            const amount = parseFloat(amountInput.value);
            const previewDiv = document.getElementById("transferPreview");
            const conversionDiv = document.getElementById("currencyConversion");
            const confirmCheckbox = document.getElementById("confirmCheckbox");
            const transferBtn = document.getElementById("transferBtn");

            if (!to || !amount || amount <= 0) {
                previewDiv.classList.add("hidden");
                conversionDiv.classList.add("hidden");
                if (confirmCheckbox) confirmCheckbox.style.display = 'none';
                transferBtn.disabled = true;
                return;
            }

            const bankCommission = amount * fees.bank / 100;
            const tax = amount * fees.tax / 100;
            const netAmount = amount - bankCommission - tax;

            const fromCurrency = currentUser;
            const toCurrency = to;
            
            if (fromCurrency !== toCurrency) {
                const conversionRate = getConversionRate(fromCurrency, toCurrency);
                const convertedAmount = amount * conversionRate;
                const convertedNetAmount = netAmount * conversionRate;
                const convertedCommission = bankCommission * conversionRate;
                const convertedTax = tax * conversionRate;
                
                conversionDiv.classList.remove("hidden");
                document.getElementById("fromAmount").textContent = amount.toFixed(2) + " " + fromCurrency;
                document.getElementById("conversionRate").textContent = "1 " + fromCurrency + " = " + conversionRate.toFixed(4) + " " + toCurrency;
                document.getElementById("toAmount").textContent = convertedAmount.toFixed(2) + " " + toCurrency;
                
                document.getElementById("commission").textContent = convertedCommission.toFixed(2) + " " + toCurrency;
                document.getElementById("tax").textContent = convertedTax.toFixed(2) + " " + toCurrency;
                document.getElementById("net").textContent = convertedNetAmount.toFixed(2) + " " + toCurrency;
            } else {
                conversionDiv.classList.add("hidden");
                document.getElementById("commission").textContent = bankCommission.toFixed(2) + " " + currentUser;
                document.getElementById("tax").textContent = tax.toFixed(2) + " " + currentUser;
                document.getElementById("net").textContent = netAmount.toFixed(2) + " " + currentUser;
            }

            document.getElementById("feeBank").textContent = fees.bank;
            document.getElementById("feeTax").textContent = fees.tax;

            previewDiv.classList.remove("hidden");
            previewDiv.style.background = 'rgba(255, 255, 255, 0.05)';
            
            if (confirmCheckbox) {
                confirmCheckbox.style.display = 'flex';
                document.getElementById("confirmTransfer").checked = false;
            }
            
            transferBtn.disabled = true;
        }

        function getConversionRate(fromCurrency, toCurrency) {
            const toCHF = exchangeRates[fromCurrency];
            const fromCHF = 1 / exchangeRates[toCurrency];
            
            return toCHF * fromCHF;
        }

        function convertCurrency(amount, fromCurrency, toCurrency) {
            if (fromCurrency === toCurrency) return amount;
            
            const rate = getConversionRate(fromCurrency, toCurrency);
            return amount * rate;
        }

        // ==================== –í–•–û–î –í –°–ò–°–¢–ï–ú–£ ====================
        function login() {
            const roleSelect = document.getElementById("role");
            const pinInput = document.getElementById("pin");
            const roleVal = roleSelect.value;
            const pinValue = pinInput.value.trim();
            const loader = document.getElementById("loginLoader");
            const loginBtn = document.getElementById("loginBtn");
            
            if (!roleVal) {
                showLoginMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É", "error");
                return;
            }
            
            if (!pinValue || pinValue.length < 4) {
                showLoginMessage("‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤", "error");
                return;
            }
            
            if (roleVal === "BANK" && !secretMode) {
                showLoginMessage("‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", "error");
                return;
            }
            
            loginBtn.disabled = true;
            loader.style.display = 'block';
            
            setTimeout(() => {
                // –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø
                if (pins[roleVal]) {
                    // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ
                    if (pins[roleVal] !== pinValue) {
                        showLoginMessage("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å", "error");
                        loader.style.display = 'none';
                        loginBtn.disabled = false;
                        return;
                    }
                } else {
                    // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—è –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                    pins[roleVal] = pinValue;
                    saveAll();
                    showLoginMessage(`‚úÖ –ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ü–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, "success");
                }
                
                if (roleVal !== "BANK" && blockedAccounts.includes(roleVal)) {
                    showLoginMessage(`‚ùå –°—á–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±–∞–Ω–∫–∏—Ä–æ–º`, "error");
                    loader.style.display = 'none';
                    loginBtn.disabled = false;
                    return;
                }
                
                currentUser = roleVal;
                localStorage.setItem("currentUser", JSON.stringify(currentUser));
                
                document.getElementById("login").classList.add("hidden");
                document.getElementById("loginMessage").classList.add("hidden");
                loader.style.display = 'none';
                loginBtn.disabled = false;
                
                if (currentUser === "BANK") {
                    document.getElementById("banker").classList.remove("hidden");
                    updateBanker();
                    updateBlockStatus();
                    updateBankerFees();
                    updateAllTransactions();
                    initBankerChart();
                    loadIcons();
                    updateUploadedIconsPreview();
                } else {
                    document.getElementById("account").classList.remove("hidden");
                    updateAccount();
                    updateTransactionHistory();
                    initExchangeChart();
                }
                
                pinInput.value = "";
                roleSelect.selectedIndex = 0;
                
                secretMode = false;
            }, 800);
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ê–ö–ö–ê–£–ù–¢–ê ====================
        function updateAccount() {
            if (!currentUser || currentUser === "BANK") return;
            
            const countryInfo = {
                "CHF": {
                    name: "–®–≤–µ–π—Ü–∞—Ä–∏—è",
                    fullName: "–®–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –±–∞–Ω–∫",
                    flag: "üá®üá≠",
                    icon: customIcons.flag_chf ? customIcons.flag_chf : "fas fa-mountain",
                    currency: "CHF (—à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π —Ñ—Ä–∞–Ω–∫)",
                    welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –®–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –±–∞–Ω–∫"
                },
                "EUR": {
                    name: "–ì–µ—Ä–º–∞–Ω–∏—è",
                    fullName: "–ë–∞–Ω–∫ –ì–µ—Ä–º–∞–Ω–∏–∏",
                    flag: "üá©üá™",
                    icon: customIcons.flag_eur ? customIcons.flag_eur : "fas fa-landmark",
                    currency: "EUR (–µ–≤—Ä–æ)",
                    welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ë–∞–Ω–∫ –ì–µ—Ä–º–∞–Ω–∏–∏"
                },
                "KRW": {
                    name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è",
                    fullName: "–ë–∞–Ω–∫ –Æ–∂–Ω–æ–π –ö–æ—Ä–µ–∏",
                    flag: "üá∞üá∑",
                    icon: customIcons.flag_krw ? customIcons.flag_krw : "fas fa-yin-yang",
                    currency: "KRW (—é–∂–Ω–æ–∫–æ—Ä–µ–π—Å–∫–∞—è –≤–æ–Ω–∞)",
                    welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ë–∞–Ω–∫ –Æ–∂–Ω–æ–π –ö–æ—Ä–µ–∏"
                }
            };
            
            const info = countryInfo[currentUser];
            
            document.getElementById("countryFlag").textContent = info.flag;
            document.getElementById("countryName").textContent = info.name;
            
            if (info.icon.startsWith('data:')) {
                document.getElementById("welcomeMessage").innerHTML = 
                    `<img src="${info.icon}" style="width: 20px; height: 20px; vertical-align: middle;"> ${info.welcome}`;
            } else {
                document.getElementById("welcomeMessage").innerHTML = 
                    `<i class="${info.icon}"></i> ${info.welcome}`;
            }
            
            document.getElementById("card").className = `card ${currentUser}`;
            
            const balance = balances[currentUser] || 0;
            const formattedBalance = currentUser === "KRW" 
                ? Math.floor(balance).toLocaleString('ru-RU')
                : balance.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            document.getElementById("balanceAmount").textContent = formattedBalance;
            document.getElementById("currencyCode").innerHTML = `<i class="fas fa-coins"></i> ${info.currency}`;
            
            document.getElementById("availableBalance").textContent = formattedBalance;
            document.getElementById("currentCurrency").textContent = currentUser;
            
            document.getElementById("chfRate").textContent = exchangeRates.CHF.toFixed(2) + " CHF";
            document.getElementById("eurRate").textContent = exchangeRates.EUR.toFixed(2) + " EUR";
            document.getElementById("krwRate").textContent = exchangeRates.KRW.toFixed(5) + " KRW";
            
            const now = new Date();
            document.getElementById("chartTime").textContent = 
                `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
            document.getElementById("transferPreview").classList.add("hidden");
            const confirmCheckbox = document.getElementById("confirmCheckbox");
            if (confirmCheckbox) confirmCheckbox.style.display = 'none';
        }

        // ==================== –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
        function initExchangeChart() {
            const ctx = document.getElementById('exchangeChart');
            
            if (exchangeChart) {
                exchangeChart.destroy();
            }
            
            const labels = ['', '', '', '', '', '', '', '', '', '', '', ''];
            
            let userData = [];
            let color = '';
            let label = '';
            
            switch(currentUser) {
                case 'CHF':
                    userData = [...rateHistory.CHF];
                    color = '#2d6a4f';
                    label = 'CHF';
                    break;
                case 'EUR':
                    userData = [...rateHistory.EUR];
                    color = '#0077b6';
                    label = 'EUR';
                    break;
                case 'KRW':
                    userData = [...rateHistory.KRW];
                    color = '#9d0208';
                    label = 'KRW √ó1000';
                    break;
            }
            
            exchangeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: label,
                            data: userData,
                            borderColor: color,
                            backgroundColor: color.replace(')', ', 0.1)').replace('rgb', 'rgba'),
                            borderWidth: 2,
                            tension: 0.2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            pointBackgroundColor: color,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            fill: true,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 5,
                            right: 10,
                            top: 10,
                            bottom: 5
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            labels: {
                                color: '#fff',
                                font: { size: 11, weight: 'bold' },
                                boxWidth: 12,
                                padding: 8
                            },
                            position: 'top',
                            align: 'start',
                            padding: 5
                        },
                        tooltip: { 
                            enabled: true,
                            backgroundColor: 'rgba(13, 27, 42, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: color,
                            borderWidth: 1,
                            cornerRadius: 4,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    if (currentUser === 'KRW') {
                                        return `${label}: ${(context.parsed.y / 1000).toFixed(5)}`;
                                    }
                                    return `${label}: ${context.parsed.y.toFixed(4)}`;
                                },
                                title: function() {
                                    return '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫—É—Ä—Å';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false,
                            grid: { 
                                display: false
                            },
                            offset: false
                        },
                        y: {
                            display: true,
                            position: 'right',
                            offset: false,
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: { size: 9 },
                                padding: 3,
                                maxTicksLimit: 5,
                                callback: function(value) {
                                    if (currentUser === 'KRW') {
                                        return (value / 1000).toFixed(3);
                                    }
                                    return value.toFixed(2);
                                }
                            },
                            beginAtZero: false
                        }
                    },
                    interaction: { 
                        intersect: false,
                        mode: 'index'
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
        }

        // ==================== –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö –î–õ–Ø –ë–ê–ù–ö–ò–†–ê ====================
        function initBankerChart() {
            const ctx = document.getElementById('bankerChart');
            
            if (bankerChart) {
                bankerChart.destroy();
            }
            
            const labels = ['', '', '', '', '', '', '', '', '', '', '', ''];
            
            bankerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'CHF',
                            data: rateHistory.CHF,
                            borderColor: '#2d6a4f',
                            backgroundColor: 'rgba(45, 106, 79, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            fill: false
                        },
                        {
                            label: 'EUR',
                            data: rateHistory.EUR,
                            borderColor: '#0077b6',
                            backgroundColor: 'rgba(0, 119, 182, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            fill: false
                        },
                        {
                            label: 'KRW √ó1000',
                            data: rateHistory.KRW,
                            borderColor: '#9d0208',
                            backgroundColor: 'rgba(157, 2, 8, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 5,
                            right: 10,
                            top: 10,
                            bottom: 5
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            labels: {
                                color: '#fff',
                                font: { size: 9, weight: 'bold' },
                                boxWidth: 8,
                                padding: 3,
                                usePointStyle: true
                            },
                            position: 'top',
                            align: 'start',
                            padding: 2
                        },
                        tooltip: {
                            backgroundColor: 'rgba(13, 27, 42, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#415a77',
                            borderWidth: 1,
                            cornerRadius: 4,
                            padding: 10,
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed.y;
                                    let label = context.dataset.label;
                                    if (label.includes('KRW')) {
                                        return `${label.replace(' √ó1000', '')}: ${(value / 1000).toFixed(5)}`;
                                    }
                                    return `${label}: ${value.toFixed(4)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false,
                            grid: { 
                                display: false
                            },
                            offset: false
                        },
                        y: {
                            display: true,
                            position: 'right',
                            offset: false,
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.6)',
                                font: { size: 8 },
                                padding: 2,
                                maxTicksLimit: 4,
                                callback: function(value) {
                                    return value.toFixed(2);
                                }
                            }
                        }
                    },
                    interaction: { 
                        intersect: false,
                        mode: 'index'
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
        }

        // ==================== –ü–ï–†–ï–í–û–î –°–†–ï–î–°–¢–í –° –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô ====================
        async function transfer() {
            const to = document.getElementById("to").value;
            const amountInput = document.getElementById("amount");
            const amount = parseFloat(amountInput.value);
            const btn = document.getElementById("transferBtn");
            const confirmCheckbox = document.getElementById("confirmCheckbox");
            
            if (!to) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–Ω–∫-–ø–æ–ª—É—á–∞—Ç–µ–ª—å", "error");
                return;
            }
            
            if (!amount || amount <= 0 || isNaN(amount)) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞", "error");
                amountInput.focus();
                return;
            }
            
            if (to === currentUser) {
                showMessage("‚ùå –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–∞–º–æ–º—É —Å–µ–±–µ", "error");
                return;
            }
            
            if (amount > balances[currentUser]) {
                showMessage(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: ${balances[currentUser].toFixed(2)} ${currentUser}`, "error");
                return;
            }
            
            if (blockedAccounts.includes(to)) {
                showMessage(`‚ùå –°—á–µ—Ç ${getCountryName(to)} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±–∞–Ω–∫–∏—Ä–æ–º`, "error");
                return;
            }
            
            if (confirmCheckbox && !document.getElementById("confirmTransfer").checked) {
                showMessage("‚ùå –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥, –ø–æ—Å—Ç–∞–≤–∏–≤ –≥–∞–ª–æ—á–∫—É", "error");
                return;
            }
            
            const bankCommission = amount * fees.bank / 100;
            const tax = amount * fees.tax / 100;
            const netAmount = amount - bankCommission - tax;
            
            const convertedNetAmount = convertCurrency(netAmount, currentUser, to);
            const convertedCommission = convertCurrency(bankCommission, currentUser, "CHF");
            const conversionRate = getConversionRate(currentUser, to);
            
            btn.disabled = true;
            
            balances[currentUser] -= amount;
            balances[to] += convertedNetAmount;
            balances.CHF += convertedCommission;
            
            const transaction = {
                id: Date.now(),
                from: currentUser,
                to: to,
                amount: amount,
                convertedAmount: convertedNetAmount,
                commission: bankCommission,
                tax: tax,
                netAmount: netAmount,
                convertedNetAmount: convertedNetAmount,
                exchangeRate: conversionRate,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };
            
            transactions.push(transaction);
            
            updateExchangeRatesBasedOnTransfer(currentUser, to, amount);
            
            saveAll();
            updateAccount();
            updateTransactionHistory();
            updateExchangeRates();
            
            if (currentUser === "BANK") {
                updateBanker();
                updateAllTransactions();
            }
            
            showTransferNotification(
                amount,
                convertedNetAmount,
                bankCommission,
                tax,
                conversionRate,
                currentUser,
                to
            );
            
            amountInput.value = "";
            document.getElementById("to").selectedIndex = 0;
            document.getElementById("transferPreview").classList.add("hidden");
            if (confirmCheckbox) {
                confirmCheckbox.style.display = 'none';
                document.getElementById("confirmTransfer").checked = false;
            }
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if (syncEnabled && databaseRef) {
                await syncDataToFirebase('balances', balances);
                await syncDataToFirebase('transactions', transactions);
                await syncDataToFirebase('exchangeRates', exchangeRates);
            }
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        function showTransferNotification(amount, convertedAmount, commission, tax, rate, fromCurrency, toCurrency) {
            const notification = document.getElementById("transferNotification");
            const conversionRow = document.getElementById("notifConversionRow");
            const conversionNote = document.getElementById("notifConversionNote");
            
            document.getElementById("notifOperation").textContent = `–ü–µ—Ä–µ–≤–æ–¥ ${getCountryName(fromCurrency)} ‚Üí ${getCountryName(toCurrency)}`;
            document.getElementById("notifSent").textContent = `${amount.toFixed(2)} ${fromCurrency}`;
            document.getElementById("notifReceived").textContent = `${convertedAmount.toFixed(2)} ${toCurrency}`;
            document.getElementById("notifCommission").textContent = `${commission.toFixed(2)} ${fromCurrency}`;
            document.getElementById("notifTax").textContent = `${tax.toFixed(2)} ${fromCurrency}`;
            document.getElementById("notifRate").textContent = `1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}`;
            
            if (fromCurrency !== toCurrency) {
                conversionRow.style.display = 'flex';
                conversionNote.style.display = 'block';
            } else {
                conversionRow.style.display = 'none';
                conversionNote.style.display = 'none';
            }
            
            notification.classList.remove("hidden");
            
            setTimeout(() => {
                notification.classList.add("hidden");
            }, 5000);
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ë–ê–ù–ö–ò–†–ê ====================
        function updateBanker() {
            const bBalances = document.getElementById("bBalances");
            
            const countries = [
                { code: "CHF", name: "–®–≤–µ–π—Ü–∞—Ä–∏—è", flag: "üá®üá≠", color: "#2d6a4f", currency: "CHF" },
                { code: "EUR", name: "–ì–µ—Ä–º–∞–Ω–∏—è", flag: "üá©üá™", color: "#0077b6", currency: "EUR" },
                { code: "KRW", name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è", flag: "üá∞üá∑", color: "#9d0208", currency: "KRW" }
            ];
            
            let html = '';
            
            countries.forEach(country => {
                const balance = balances[country.code] || 0;
                const formattedBalance = country.code === "KRW" 
                    ? Math.floor(balance).toLocaleString('ru-RU')
                    : balance.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                html += `
                    <div class="balance-item">
                        <div class="balance-info">
                            <div class="balance-flag">${country.flag}</div>
                            <div class="balance-details">
                                <div class="balance-country">${country.name} (${country.currency})</div>
                                <div class="balance-value" style="color: ${country.color};">${formattedBalance} ${country.currency}</div>
                                <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">
                                    –ü–∞—Ä–æ–ª—å: <span class="password-display" data-country="${country.code}">
                                        ${showPasswords ? (pins[country.code] || "–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω") : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <button class="show-password-btn" onclick="togglePassword('${country.code}')">
                            <i class="fas fa-eye${showPasswords ? '-slash' : ''}"></i> ${showPasswords ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'}
                        </button>
                    </div>
                `;
            });
            
            html += `
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button onclick="toggleAllPasswords()" class="show-password-btn" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-eye${showPasswords ? '-slash' : ''}"></i> ${showPasswords ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏'}
                    </button>
                </div>
            `;
            
            bBalances.innerHTML = html;
        }
        
        function togglePassword(country) {
            const passwordDisplays = document.querySelectorAll(`[data-country="${country}"]`);
            passwordDisplays.forEach(display => {
                if (display.textContent === "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢") {
                    display.textContent = pins[country] || "–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω";
                } else {
                    display.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
                }
            });
        }
        
        function toggleAllPasswords() {
            showPasswords = !showPasswords;
            updateBanker();
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–£–†–°–û–í –í–ê–õ–Æ–¢ ====================
        function updateExchangeRatesBasedOnTransfer(from, to, amount) {
            const impact = amount * 0.00001;
            
            if (exchangeRates[from]) {
                exchangeRates[from] = Math.max(0.01, exchangeRates[from] - impact);
            }
            
            if (exchangeRates[to]) {
                exchangeRates[to] += impact;
            }
            
            exchangeRates.CHF = parseFloat(exchangeRates.CHF.toFixed(4));
            exchangeRates.EUR = parseFloat(exchangeRates.EUR.toFixed(4));
            exchangeRates.KRW = parseFloat(exchangeRates.KRW.toFixed(6));
            
            rateHistory.CHF.push(exchangeRates.CHF);
            rateHistory.EUR.push(exchangeRates.EUR);
            rateHistory.KRW.push(exchangeRates.KRW * 1000);
            
            if (rateHistory.CHF.length > 12) {
                rateHistory.CHF.shift();
                rateHistory.EUR.shift();
                rateHistory.KRW.shift();
            }
        }

        function updateExchangeRates() {
            if (exchangeChart) exchangeChart.update();
            if (bankerChart) bankerChart.update();
            
            if (currentUser && currentUser !== "BANK") {
                updateAccount();
            }
            
            saveAll();
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function getCountryName(code) {
            const names = {
                "CHF": "–®–≤–µ–π—Ü–∞—Ä–∏—è",
                "EUR": "–ì–µ—Ä–º–∞–Ω–∏—è",
                "KRW": "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è",
                "BANK": "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–Ω–∫ –ï–≤—Ä–æ—Å–æ—é–∑–∞"
            };
            return names[code] || code;
        }

        function showMessage(text, type) {
            const detailsDiv = document.getElementById("transferDetails");
            detailsDiv.innerHTML = `<div class="${type}"><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${text}</div>`;
            detailsDiv.classList.remove("hidden");
            
            if (type === "success") {
                setTimeout(() => {
                    detailsDiv.classList.add("hidden");
                }, 5000);
            }
        }

        function showLoginMessage(text, type) {
            const messageDiv = document.getElementById("loginMessage");
            messageDiv.innerHTML = `<div class="${type}"><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${text}</div>`;
            messageDiv.classList.remove("hidden");
        }

        function logout() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?")) {
                localStorage.removeItem("currentUser");
                location.reload();
            }
        }

        function resetGame() {
            if (!confirm("‚ö†Ô∏è –û–±–Ω—É–ª–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞?\n\n–í—Å–µ —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã, –ø–∞—Ä–æ–ª–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç —Å–±—Ä–æ—à–µ–Ω—ã –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º.")) {
                return;
            }
            
            const savedPwaIcon = localStorage.getItem("bankPwaIcon");
            const savedCustomIcons = JSON.parse(localStorage.getItem("bankCustomIcons")) || {};
            
            pins = {};
            balances = { CHF: 0, EUR: 0, KRW: 0 };
            fees = { bank: 2, tax: 3 };
            exchangeRates = { CHF: 1.00, EUR: 0.93, KRW: 0.00077 };
            blockedAccounts = [];
            
            rateHistory = {
                CHF: [],
                EUR: [],
                KRW: []
            };
            
            for (let i = 0; i < 12; i++) {
                const baseCHF = 1.00;
                const baseEUR = 0.93;
                const baseKRW = 0.00077;
                
                const chfVariation = baseCHF + (Math.sin(i * 0.5) * 0.01) + ((Math.random() - 0.5) * 0.005);
                const eurVariation = baseEUR + (Math.sin(i * 0.5 + 1) * 0.015) + ((Math.random() - 0.5) * 0.008);
                const krwVariation = baseKRW + (Math.sin(i * 0.5 + 2) * 0.00002) + ((Math.random() - 0.5) * 0.00001);
                
                rateHistory.CHF.push(chfVariation);
                rateHistory.EUR.push(eurVariation);
                rateHistory.KRW.push(krwVariation * 1000);
            }
            
            transactions = [];
            showPasswords = false;
            
            if (savedPwaIcon) {
                localStorage.setItem("bankPwaIcon", savedPwaIcon);
                pwaIconData = savedPwaIcon;
            }
            
            if (Object.keys(savedCustomIcons).length > 0) {
                localStorage.setItem("bankCustomIcons", JSON.stringify(savedCustomIcons));
                customIcons = savedCustomIcons;
            }
            
            localStorage.removeItem("currentUser");
            currentUser = null;
            
            saveAll();
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–±—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            if (syncEnabled && databaseRef) {
                syncAllDataToFirebase();
            }
            
            location.reload();
        }

        function changePin() {
            const newPinInput = document.getElementById("newPin");
            const newPinVal = newPinInput.value.trim();
            const btn = document.getElementById("changePinBtn");
            
            if (!newPinVal) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å", "error");
                newPinInput.focus();
                return;
            }
            
            if (newPinVal.length < 4) {
                showMessage("‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤", "error");
                newPinInput.focus();
                return;
            }
            
            btn.disabled = true;
            
            pins[currentUser] = newPinVal;
            saveAll();
            
            newPinInput.value = "";
            showMessage("‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω", "success");
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        async function addFunds() {
            const countrySelect = document.getElementById("fundCountry");
            const amountInput = document.getElementById("fundAmount");
            const country = countrySelect.value;
            const amount = parseFloat(amountInput.value);
            const btn = document.getElementById("addFundsBtn");
            
            if (!country) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤", "error");
                return;
            }
            
            if (!amount || amount <= 0 || isNaN(amount)) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É", "error");
                amountInput.focus();
                return;
            }
            
            btn.disabled = true;
            
            if (!balances[country]) {
                balances[country] = 0;
            }
            
            balances[country] += amount;
            
            const transaction = {
                id: Date.now(),
                from: "BANK",
                to: country,
                amount: amount,
                commission: 0,
                tax: 0,
                netAmount: amount,
                date: new Date().toISOString(),
                timestamp: Date.now(),
                type: "bank_deposit"
            };
            
            transactions.push(transaction);
            
            saveAll();
            updateBanker();
            updateAllTransactions();
            
            showMessage(
                `‚úÖ –°—Ä–µ–¥—Å—Ç–≤–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!<br><br>` +
                `<strong><i class="fas fa-plus-circle"></i> –û–ø–µ—Ä–∞—Ü–∏—è:</strong> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤<br>` +
                `<strong><i class="fas fa-flag"></i> –°—Ç—Ä–∞–Ω–∞:</strong> ${getCountryName(country)}<br>` +
                `<strong><i class="fas fa-coins"></i> –°—É–º–º–∞:</strong> ${amount.toFixed(2)} ${country}<br>` +
                `<strong><i class="fas fa-wallet"></i> –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:</strong> ${balances[country].toFixed(2)} ${country}`,
                "success"
            );
            
            amountInput.value = "";
            countrySelect.selectedIndex = 0;
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if (syncEnabled && databaseRef) {
                await syncDataToFirebase('balances', balances);
                await syncDataToFirebase('transactions', transactions);
            }
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        async function removeFunds() {
            const countrySelect = document.getElementById("fundCountry");
            const amountInput = document.getElementById("fundAmount");
            const country = countrySelect.value;
            const amount = parseFloat(amountInput.value);
            const btn = document.getElementById("removeFundsBtn");
            
            if (!country) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤", "error");
                return;
            }
            
            if (!amount || amount <= 0 || isNaN(amount)) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É", "error");
                amountInput.focus();
                return;
            }
            
            if (!balances[country] || amount > balances[country]) {
                showMessage(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: ${balances[country]?.toFixed(2) || "0"} ${country}`, "error");
                return;
            }
            
            btn.disabled = true;
            
            balances[country] -= amount;
            
            const transaction = {
                id: Date.now(),
                from: country,
                to: "BANK",
                amount: amount,
                commission: 0,
                tax: 0,
                netAmount: amount,
                date: new Date().toISOString(),
                timestamp: Date.now(),
                type: "bank_withdrawal"
            };
            
            transactions.push(transaction);
            
            saveAll();
            updateBanker();
            updateAllTransactions();
            
            showMessage(
                `‚úÖ –°—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!<br><br>` +
                `<strong><i class="fas fa-minus-circle"></i> –û–ø–µ—Ä–∞—Ü–∏—è:</strong> –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤<br>` +
                `<strong><i class="fas fa-flag"></i> –°—Ç—Ä–∞–Ω–∞:</strong> ${getCountryName(country)}<br>` +
                `<strong><i class="fas fa-coins"></i> –°—É–º–º–∞:</strong> ${amount.toFixed(2)} ${country}<br>` +
                `<strong><i class="fas fa-wallet"></i> –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:</strong> ${balances[country].toFixed(2)} ${country}`,
                "success"
            );
            
            amountInput.value = "";
            countrySelect.selectedIndex = 0;
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if (syncEnabled && databaseRef) {
                await syncDataToFirebase('balances', balances);
                await syncDataToFirebase('transactions', transactions);
            }
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        async function saveFees() {
            const bankFee = parseFloat(document.getElementById("bankFee").value);
            const taxFee = parseFloat(document.getElementById("taxFee").value);
            const btn = document.getElementById("saveFeesBtn");
            
            if (isNaN(bankFee) || bankFee < 0 || bankFee > 50) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é –±–∞–Ω–∫–∞ (0-50%)", "error");
                return;
            }
            
            if (isNaN(taxFee) || taxFee < 0 || taxFee > 50) {
                showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–∞–ª–æ–≥ (0-50%)", "error");
                return;
            }
            
            btn.disabled = true;
            
            fees.bank = bankFee;
            fees.tax = taxFee;
            
            saveAll();
            showMessage(`‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:<br><i class="fas fa-percentage"></i> –ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞: ${bankFee}%<br><i class="fas fa-receipt"></i> –ù–∞–ª–æ–≥: ${taxFee}%`, "success");
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if (syncEnabled && databaseRef) {
                await syncDataToFirebase('fees', fees);
            }
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        async function toggleBlock() {
            const blockSelect = document.getElementById("blockSelect");
            const country = blockSelect.value;
            const btn = document.getElementById("toggleBlockBtn");
            
            if (!country) {
                showMessage("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π", "error");
                return;
            }
            
            const countryName = getCountryName(country);
            const isBlocked = blockedAccounts.includes(country);
            
            btn.disabled = true;
            
            if (isBlocked) {
                blockedAccounts = blockedAccounts.filter(acc => acc !== country);
                showMessage(`‚úÖ –°—á–µ—Ç ${countryName} —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, "success");
            } else {
                blockedAccounts.push(country);
                showMessage(`üö´ –°—á–µ—Ç ${countryName} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, "success");
            }
            
            saveAll();
            updateBlockStatus();
            blockSelect.selectedIndex = 0;
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if (syncEnabled && databaseRef) {
                await syncDataToFirebase('blockedAccounts', blockedAccounts);
            }
            
            setTimeout(() => {
                btn.disabled = false;
            }, 1000);
        }

        function updateBankerFees() {
            document.getElementById("bankFee").value = fees.bank;
            document.getElementById("taxFee").value = fees.tax;
        }

        function updateBlockStatus() {
            const blockStatus = document.getElementById("blockStatus");
            let html = `<div style="font-size: 13px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-shield-alt"></i> –°—Ç–∞—Ç—É—Å –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤:
                        </div>`;
            
            const countries = [
                { code: "CHF", name: "–®–≤–µ–π—Ü–∞—Ä–∏—è", flag: "üá®üá≠", icon: "fas fa-mountain" },
                { code: "EUR", name: "–ì–µ—Ä–º–∞–Ω–∏—è", flag: "üá©üá™", icon: "fas fa-landmark" },
                { code: "KRW", name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è", flag: "üá∞üá∑", icon: "fas fa-yin-yang" }
            ];
            
            countries.forEach(country => {
                const isBlocked = blockedAccounts.includes(country.code);
                html += `
                    <div style="margin: 8px 0; padding: 12px; background: ${isBlocked ? 'rgba(157, 2, 8, 0.1)' : 'rgba(45, 106, 79, 0.1)'}; 
                         border-radius: 8px; border-left: 3px solid ${isBlocked ? '#9d0208' : '#2d6a4f'};
                         display: flex; justify-content: space-between; align-items: center;">
                        <span style="display: flex; align-items: center; gap: 10px;">
                            ${country.flag} 
                            <i class="${country.icon}"></i>
                            <strong style="font-size: 14px;">${country.name}</strong>
                        </span>
                        <span style="font-size: 13px; display: flex; align-items: center; gap: 6px;">
                            ${isBlocked ? '<i class="fas fa-ban"></i> üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '<i class="fas fa-check"></i> ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω'}
                        </span>
                    </div>
                `;
            });
            
            blockStatus.innerHTML = html;
        }

        function activateSecretMode() {
            secretMode = true;
            const roleSelect = document.getElementById("role");
            const secretAccessDiv = document.getElementById("secretAccess");
            
            if (roleSelect.querySelector('option[value="BANK"]') === null) {
                const bankerOption = document.createElement('option');
                bankerOption.value = "BANK";
                bankerOption.textContent = "üè¶ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–Ω–∫ –ï–≤—Ä–æ—Å–æ—é–∑–∞";
                roleSelect.appendChild(bankerOption);
            }
            
            secretAccessDiv.style.display = 'block';
            
            setTimeout(() => {
                secretAccessDiv.style.display = 'none';
            }, 3000);
            
            console.log("üîê –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
        }

        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            for (let i = 0; i < arr1.length; i++) {
                if (arr1[i] !== arr2[i]) return false;
            }
            return true;
        }

        function showHelp() {
            const helpText = `
                <div class="success">
                    <h4><i class="fas fa-question-circle"></i> –°–ü–†–ê–í–ö–ê –ü–û –°–ò–°–¢–ï–ú–ï</h4>
                    <p><strong>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–ª–∏ –≤—Ö–æ–¥–∞ –≤ –∞–∫–∫–∞—É–Ω—Ç</li>
                        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å (–Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤)</li>
                        <li>–ü–æ–ø–æ–ª–Ω—è–π—Ç–µ —Å—á–µ—Ç –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥—Ä—É–≥–∏–º —Å—Ç—Ä–∞–Ω–∞–º</li>
                        <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ</li>
                    </ul>
                    <p><strong>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</li>
                        <li>–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ü–ö, —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö –∏ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</li>
                        <li>–ü—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å –æ–¥–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥—Ä—É–≥–æ–µ —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                        <li>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</li>
                    </ul>
                    <p><strong>–ì—Ä–∞—Ñ–∏–∫ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–ß–µ—Ç–∫–∏–π –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –∫—É—Ä—Å–∞</li>
                        <li>–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –≥—Ä–∞—Ñ–∏–∫ –∏—Ö –≤–∞–ª—é—Ç—ã</li>
                        <li>–î–ª—è –±–∞–Ω–∫–∏—Ä–∞ - —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –≤—Å–µ—Ö –≤–∞–ª—é—Ç</li>
                    </ul>
                    <p><strong>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–ü—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è</li>
                        <li>–ö—É—Ä—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –∫–æ—Ç–∏—Ä–æ–≤–æ–∫</li>
                        <li>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –¥–µ—Ç–∞–ª—è—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
                    </ul>
                    <p><strong>–ö–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞–ª–æ–≥–∏:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞: ${fees.bank}% –æ—Ç —Å—É–º–º—ã –ø–µ—Ä–µ–≤–æ–¥–∞</li>
                        <li>–ù–∞–ª–æ–≥: ${fees.tax}% –æ—Ç —Å—É–º–º—ã –ø–µ—Ä–µ–≤–æ–¥–∞</li>
                    </ul>
                    <p><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∫–æ–Ω–æ–∫ (–¥–ª—è –±–∞–Ω–∫–∏—Ä–∞):</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Å–≤–æ–∏ PNG/JPG –∏–∫–æ–Ω–∫–∏</li>
                        <li>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∫–æ–Ω–æ–∫</li>
                        <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
                        <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞</li>
                        <li>–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–Ω–æ–ø–∫–æ–π "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É"</li>
                    </ul>
                    <p><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PWA-–∏–∫–æ–Ω–∫–∏ (–¥–ª—è –±–∞–Ω–∫–∏—Ä–∞):</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ PNG/JPEG –∏–∫–æ–Ω–∫—É 512x512 –ø–∏–∫—Å–µ–ª–µ–π</li>
                        <li>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–∞–∫ –∏–∫–æ–Ω–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"</li>
                        <li>–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</li>
                        <li>–ò–∫–æ–Ω–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ</li>
                    </ul>
                    <p><strong>–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ï–≤—Ä–æ—Å–æ—é–∑–∞:</strong> –Ω–∞–±–µ—Ä–∏—Ç–µ "banker" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                </div>
            `;
            
            showMessage(helpText, "success");
        }

        function updateTransactionHistory() {
            const transactionHistory = document.getElementById("transactionHistory");
            
            const userTransactions = transactions.filter(t => t.from === currentUser || t.to === currentUser);
            
            if (userTransactions.length === 0) {
                transactionHistory.innerHTML = `
                    <p style="text-align: center; opacity: 0.7; font-size: 14px; padding: 20px;">
                        –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
                    </p>
                `;
                return;
            }
            
            userTransactions.sort((a, b) => b.timestamp - a.timestamp);
            
            let html = '';
            userTransactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const isOutgoing = transaction.from === currentUser;
                const otherCountry = isOutgoing ? transaction.to : transaction.from;
                
                const conversionInfo = transaction.exchangeRate && transaction.exchangeRate !== 1 ? 
                    `<div style="font-size: 11px; color: var(--warning); margin-top: 3px;">
                        <i class="fas fa-exchange-alt"></i> –ö—É—Ä—Å: ${transaction.exchangeRate.toFixed(4)} ‚Üí ${transaction.convertedAmount?.toFixed(2) || transaction.convertedNetAmount?.toFixed(2)} ${otherCountry}
                    </div>` : '';
                
                html += `
                    <div class="transaction-item">
                        <div class="transaction-header">
                            <span style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-${isOutgoing ? 'arrow-up' : 'arrow-down'}" style="color: ${isOutgoing ? '#f44336' : '#4caf50'}"></i>
                                <span>${getCountryName(otherCountry)}</span>
                            </span>
                            <span class="transaction-amount" style="color: ${isOutgoing ? '#f44336' : '#4caf50'}">
                                ${isOutgoing ? '-' : '+'}${transaction.amount.toFixed(2)} ${currentUser}
                            </span>
                        </div>
                        <div class="transaction-details">
                            ${isOutgoing ? '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' : '–ü–æ–ª—É—á–µ–Ω–æ'} 
                            ‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è: ${transaction.commission.toFixed(2)} ${transaction.from}
                            ${transaction.tax > 0 ? `‚Ä¢ –ù–∞–ª–æ–≥: ${transaction.tax.toFixed(2)} ${transaction.from}` : ''}
                        </div>
                        ${conversionInfo}
                        <div class="transaction-date">
                            ${formattedDate}
                        </div>
                    </div>
                `;
            });
            
            transactionHistory.innerHTML = html;
        }
        
        function updateAllTransactions() {
            const allTransactionsDiv = document.getElementById("allTransactions");
            
            if (transactions.length === 0) {
                allTransactionsDiv.innerHTML = `
                    <p style="text-align: center; opacity: 0.7; font-size: 14px; padding: 20px;">
                        –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
                `;
                return;
            }
            
            const sortedTransactions = [...transactions].sort((a, b) => b.timestamp - a.timestamp);
            
            let html = '';
            sortedTransactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const conversionInfo = transaction.exchangeRate && transaction.exchangeRate !== 1 ? 
                    `<div style="font-size: 11px; color: var(--warning); margin-top: 3px;">
                        <i class="fas fa-exchange-alt"></i> –ö—É—Ä—Å: ${transaction.exchangeRate.toFixed(4)} ‚Üí ${transaction.convertedAmount?.toFixed(2) || transaction.convertedNetAmount?.toFixed(2)} ${transaction.to}
                    </div>` : '';
                
                html += `
                    <div class="transaction-item">
                        <div class="transaction-header">
                            <span style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exchange-alt"></i>
                                <span>${getCountryName(transaction.from)} ‚Üí ${getCountryName(transaction.to)}</span>
                            </span>
                            <span class="transaction-amount">
                                ${transaction.amount.toFixed(2)} ${transaction.from}
                            </span>
                        </div>
                        <div class="transaction-details">
                            –ö–æ–º–∏—Å—Å–∏—è: ${transaction.commission.toFixed(2)} ${transaction.from}
                            ‚Ä¢ –ù–∞–ª–æ–≥: ${transaction.tax.toFixed(2)} ${transaction.from}
                            ‚Ä¢ –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª: ${transaction.convertedNetAmount?.toFixed(2) || transaction.netAmount.toFixed(2)} ${transaction.to}
                        </div>
                        ${conversionInfo}
                        <div class="transaction-date">
                            ${formattedDate}
                        </div>
                    </div>
                `;
            });
            
            allTransactionsDiv.innerHTML = html;
        }
    </script>
</body>

</html>

